---
title: "Experimental treatment with edaravone in a mouse model of spinocerebellar ataxia 1"
subtitle: "Analysis of mitochondrial respiration"
author: "Martina Sucha, Simona Benediktova, Filip Tichanek, Jan Jedlicka, Stepan Kapl, Dana Jelinkova, Zdenka Purkartova, Jan Tuma, Jitka Kuncova, Jan Cendelin"
format: 
  html:
    embed-resources: true
    keep-md: true
    toc: true
    toc-depth: 4
    toc-location: left
    number-sections: true
    number-depth: 4
    code-fold: false
    code-summary: "Open code"
editor: visual
project:
  type: default
  output-dir: output
theme: sandstone
fontsize: 13.5px
---

This page shows R code for the study [Sucha et al.](https://www.mdpi.com/1422-0067/24/13/10689) (2023, *International Journal of Molecular Science*).

**Citation**:

> Sucha M, Benediktova S, Tichanek F, Jedlicka J, Kapl S, Jelinkova D, Purkartova Z, Tuma J, Kuncova J, Cendelin J. Experimental Treatment with Edaravone in a Mouse Model of Spinocerebellar Ataxia 1. International Journal of Molecular Sciences. 2023; 24(13):10689. https://doi.org/10.3390/ijms241310689

[GitHub page](https://github.com/filip-tichanek/edaravonSCA1): https://github.com/filip-tichanek/edaravonSCA1

Mitochodnrial respiration was analysed in cerebellar (***cb***) and hippocampal (***hp***) tissue. Respiration was standardized by either tissue wet weight of (***mg***) or by citrate synthase activity (***cs***), across different phases experiment


# Upload of packages

```{r}
rm(list = ls())

suppressWarnings(suppressMessages( {
library(brms)
library(beeswarm)
library(vioplot)
library(glmmTMB)
library(car)
library(cowplot)
library(ggplot2)
library(tidyverse)
library(bayesplot)
library(gtsummary)
library(vegan)
library(knitr)  
library(ggplot2)  
  } ) )
```

# Data upload and wrangling

```{r}

## Data upload
load("source_data/myEnvironment.RData")

## connecting datasets
mitochondria <- mitochondria %>% filter(
  C_iv != 'NA'
) %>% mutate(id = as.factor(id))

## defining new variables
mitochondria$group <- interaction(mitochondria$treatment,mitochondria$genotype)
mitochondria$group <- factor(mitochondria$group,
                           levels=c('ctrl.wt','eda.wt','ctrl.sca','eda.sca'))

mitochondria$sex_num <- ifelse(mitochondria$sex == "f", -0.5, 0.5)

mitochondria$group_sex <- interaction(mitochondria$treatment,
                                    mitochondria$genotype,
                                    mitochondria$sex)

mitochondria$group_sex <- factor(mitochondria$group_sex,
                               levels=c('ctrl.wt.f','ctrl.wt.m',
                                        'eda.wt.f','eda.wt.m',
                                        'ctrl.sca.f','ctrl.sca.m',
                                        'eda.sca.f','eda.sca.m'))

mitochondria$id <- as.factor(mitochondria$id)

names(mitochondria)

## subseting according to sex
mitochondria_m <- subset(mitochondria, mitochondria$sex == "m")
mitochondria_f <- subset(mitochondria, mitochondria$sex == "f")


## subsetting according to brain region and standardization

mg_cb <- subset(mitochondria,
                mitochondria$normalisation == 'mg' & 
                mitochondria$region == 'cerebellum')

cs_cb <- subset(mitochondria,
                mitochondria$normalisation == 'cs' &
                mitochondria$region == 'cerebellum')

mg_hp <- subset(mitochondria,
                mitochondria$normalisation  == 'mg' &
                mitochondria$region == 'hippocampus')

cs_hp <- subset(mitochondria,
                mitochondria$normalisation == 'cs' &
                mitochondria$region=='hippocampus')

## re-scaling respiration standardized by citrate synthase
cs_cb[,c(9:19)] <- cs_cb[,c(9:19)]/1000
cs_hp[,c(9:19)] <- cs_hp[,c(9:19)]/1000
```

# Hippocampus, weight standardization

## Data exploration

```{r, fig.heigth=7, fig.width=10}
par(mfrow=c(2,5))
par(mar=c(5,5,1,0))
par(mgp=c(3.6, 0.6,0))

## both sexes together
plot(mg_hp$P~mg_hp$group,
     col=cola, cex.axis=0.8, las=2)

plot(mg_hp$S~mg_hp$group,
     col=cola, cex.axis=0.8, las=2)

plot(mg_hp$Fccp~mg_hp$group,
     col=cola, cex.axis=0.8, las=2)

plot(mg_hp$Rot~mg_hp$group,
     col=cola, cex.axis=0.8, las=2)

plot(mg_hp$C_iv~mg_hp$group,
     col=cola, cex.axis=0.8, las=2)


## by both group and sex
plot(mg_hp$P~mg_hp$group_sex,
     col=cola[c(1,1,2,2,3,3,4,4)],cex.axis=0.8, las=2)

plot(mg_hp$S~mg_hp$group_sex,
     col=cola[c(1,1,2,2,3,3,4,4)],cex.axis=0.8, las=2)

plot(mg_hp$Fccp~mg_hp$group_sex,
     col=cola[c(1,1,2,2,3,3,4,4)],cex.axis=0.8, las=2)

plot(mg_hp$Rot~mg_hp$group_sex,
     col=cola[c(1,1,2,2,3,3,4,4)],cex.axis=0.8, las=2)

plot(mg_hp$C_iv~mg_hp$group_sex,
     col=cola[c(1,1,2,2,3,3,4,4)],cex.axis=0.8, las=2)
```
No consistent sex effect. Se will be thus ignored

Data distribution seems to be asymmetric From this reason, and also because the data are continuous and non-negative, we will employ gamma regression 

## Modelling

To model all 5 parameters (reflecting mitochondrial respiration capacity in difference phases of mitochondrial respiratory cycle) in a single model, we will fit multivariate regression. 

As there are technical replicates (two measurements per animal and brain region), we will apply hierarchical model with random intercept. 

### Setting priors

Although we measured mitochondrial respiration in our previous publication ([Tichanek et al., 2020](https://www.nature.com/articles/s41598-020-62308-0)), context was different in the sense that previous publication used group-housed mice not undergoing any test or manipulation. In contrast, these data are from mice which have been tested in behavioral tests and which were handled regularly. 

For simplicity, we will use default prior for intercept
```{r}
## re-leveling groups
mg_hp$group<-relevel(mg_hp$group,ref='ctrl.sca')

## formulas
bf_P<-bf(P~group+(1|id))
bf_S<-bf(S~group+(1|id))
bf_Fccp<-bf(Fccp~group+(1|id))
bf_Rot<-bf(Rot~group+(1|id))
bf_C_iv<-bf(C_iv~group+(1|id))

## prior setting
prior_1 <- get_prior(bf_P + bf_S + bf_Fccp + bf_Rot + bf_C_iv,
                     data = mg_hp, 
                     family=Gamma(link="log"))
prior_1

prior_1$prior[c(4,6,13,15,22,24,31,33,40,42)] <- "normal(0,2)"
prior_1$prior[c(5,14,23,32,41)] <- "normal(0,1.2)"
```

### Fitting the model
```{r}
mg_hp_model <- run_model(
          brm(bf_P+bf_S+bf_Fccp+bf_Rot+bf_C_iv,
              data=mg_hp, prior = prior_1,
              family=Gamma(link='log'),
              save_pars = save_pars(all = TRUE),
              iter=8000, warmup=2000,chains=2,cores=1,seed=17,
              control = list(adapt_delta = 0.99)),
             'output/brm/mg_hp_model', reuse = TRUE)

summary(mg_hp_model)
```
Rhat values and ESS are fine, model converged well. 

### PPC
```{r}
pp_check(mg_hp_model,type='dens_overlay',ndraws = 50,resp="P")
pp_check(mg_hp_model,type='dens_overlay_grouped',ndraws = 50,group='group',resp="P")
pp_check(mg_hp_model,type="stat_2d", stat = c("max", "min"),ndraws=100,resp="P")
pp_check(mg_hp_model,type="stat_2d", stat = c("mean", "sd"),ndraws=200,resp="P")

pp_check(mg_hp_model,type='dens_overlay',ndraws = 50,resp="S")
pp_check(mg_hp_model,type='dens_overlay_grouped',ndraws = 50,group='group',resp="S")
pp_check(mg_hp_model,type="stat_2d", stat = c("max", "min"),ndraws=100,resp="S")
pp_check(mg_hp_model,type="stat_2d", stat = c("mean", "sd"),ndraws=200,resp="S")

pp_check(mg_hp_model,type='dens_overlay',ndraws = 50,resp="Fccp")
pp_check(mg_hp_model,type='dens_overlay_grouped',ndraws = 50,group='group',resp="Fccp")
pp_check(mg_hp_model,type="stat_2d", stat = c("max", "min"),ndraws=100,resp="Fccp")
pp_check(mg_hp_model,type="stat_2d", stat = c("mean", "sd"),ndraws=200,resp="Fccp")

pp_check(mg_hp_model,type='dens_overlay',ndraws = 50,resp="Rot")
pp_check(mg_hp_model,type='dens_overlay_grouped',ndraws = 50,group='group',resp="Rot")
pp_check(mg_hp_model,type="stat_2d", stat = c("max", "min"),ndraws=100,resp="Rot")
pp_check(mg_hp_model,type="stat_2d", stat = c("mean", "sd"),ndraws=200,resp="Rot")

pp_check(mg_hp_model,type='dens_overlay',ndraws = 50,resp="Civ")
pp_check(mg_hp_model,type='dens_overlay_grouped',ndraws = 50,group='group',resp="Civ")
pp_check(mg_hp_model,type="stat_2d", stat = c("max", "min"),ndraws=100,resp="Civ")
pp_check(mg_hp_model,type="stat_2d", stat = c("mean", "sd"),ndraws=200,resp="Civ")
```
PPC looks fine, no serious issue detected. 

### Extraction of posterior samples
```{r}

post_fix_mg_hp_P <- as.data.frame(mg_hp_model, variable = c("b_P_Intercept","b_P_groupctrl.wt",
                                                      "b_P_groupeda.wt","b_P_groupeda.sca"))
names(post_fix_mg_hp_P)[1] <- "sca_ctrl"
post_fix_mg_hp_P$wt_ctrl <- post_fix_mg_hp_P$sca_ctrl+post_fix_mg_hp_P$b_P_groupctrl.wt
post_fix_mg_hp_P$wt_eda <- post_fix_mg_hp_P$sca_ctrl+post_fix_mg_hp_P$b_P_groupeda.wt
post_fix_mg_hp_P$sca_eda <- post_fix_mg_hp_P$sca_ctrl+post_fix_mg_hp_P$b_P_groupeda.sca
post_fix_mg_hp_P$wt_contrast <- post_fix_mg_hp_P$wt_eda-post_fix_mg_hp_P$wt_ctrl

post_fix_mg_hp_S <- as.data.frame(mg_hp_model, variable = c("b_S_Intercept","b_S_groupctrl.wt",
                                                          "b_S_groupeda.wt","b_S_groupeda.sca"))
names(post_fix_mg_hp_S)[1] <- "sca_ctrl"
post_fix_mg_hp_S$wt_ctrl <- post_fix_mg_hp_S$sca_ctrl+post_fix_mg_hp_S$b_S_groupctrl.wt
post_fix_mg_hp_S$wt_eda <- post_fix_mg_hp_S$sca_ctrl+post_fix_mg_hp_S$b_S_groupeda.wt
post_fix_mg_hp_S$sca_eda <- post_fix_mg_hp_S$sca_ctrl+post_fix_mg_hp_S$b_S_groupeda.sca
post_fix_mg_hp_S$wt_contrast <- post_fix_mg_hp_S$wt_eda-post_fix_mg_hp_S$wt_ctrl

post_fix_mg_hp_Fccp <- as.data.frame(mg_hp_model, variable = 
                                       c("b_Fccp_Intercept","b_Fccp_groupctrl.wt",
                                         "b_Fccp_groupeda.wt","b_Fccp_groupeda.sca"))
names(post_fix_mg_hp_Fccp)[1] <- "sca_ctrl"
post_fix_mg_hp_Fccp$wt_ctrl <- post_fix_mg_hp_Fccp$sca_ctrl+post_fix_mg_hp_Fccp$b_Fccp_groupctrl.wt
post_fix_mg_hp_Fccp$wt_eda <- post_fix_mg_hp_Fccp$sca_ctrl+post_fix_mg_hp_Fccp$b_Fccp_groupeda.wt
post_fix_mg_hp_Fccp$sca_eda <- post_fix_mg_hp_Fccp$sca_ctrl+post_fix_mg_hp_Fccp$b_Fccp_groupeda.sca
post_fix_mg_hp_Fccp$wt_contrast <- post_fix_mg_hp_Fccp$wt_eda-post_fix_mg_hp_Fccp$wt_ctrl

post_fix_mg_hp_Rot <- as.data.frame(mg_hp_model, variable = c("b_Rot_Intercept","b_Rot_groupctrl.wt",
                                                          "b_Rot_groupeda.wt","b_Rot_groupeda.sca"))
names(post_fix_mg_hp_Rot)[1] <- "sca_ctrl"
post_fix_mg_hp_Rot$wt_ctrl <- post_fix_mg_hp_Rot$sca_ctrl+post_fix_mg_hp_Rot$b_Rot_groupctrl.wt
post_fix_mg_hp_Rot$wt_eda <- post_fix_mg_hp_Rot$sca_ctrl+post_fix_mg_hp_Rot$b_Rot_groupeda.wt
post_fix_mg_hp_Rot$sca_eda <- post_fix_mg_hp_Rot$sca_ctrl+post_fix_mg_hp_Rot$b_Rot_groupeda.sca
post_fix_mg_hp_Rot$wt_contrast <- post_fix_mg_hp_Rot$wt_eda-post_fix_mg_hp_Rot$wt_ctrl

post_fix_mg_hp_Civ <- as.data.frame(mg_hp_model, variable = c("b_Civ_Intercept","b_Civ_groupctrl.wt",
                                                          "b_Civ_groupeda.wt","b_Civ_groupeda.sca"))
names(post_fix_mg_hp_Civ)[1] <- "sca_ctrl"
post_fix_mg_hp_Civ$wt_ctrl <- post_fix_mg_hp_Civ$sca_ctrl+post_fix_mg_hp_Civ$b_Civ_groupctrl.wt
post_fix_mg_hp_Civ$wt_eda <- post_fix_mg_hp_Civ$sca_ctrl+post_fix_mg_hp_Civ$b_Civ_groupeda.wt
post_fix_mg_hp_Civ$sca_eda <- post_fix_mg_hp_Civ$sca_ctrl+post_fix_mg_hp_Civ$b_Civ_groupeda.sca
post_fix_mg_hp_Civ$wt_contrast <- post_fix_mg_hp_Civ$wt_eda-post_fix_mg_hp_Civ$wt_ctrl
```

## Data and model visualization

In data visualization, individual points represent average per subject. Violin plot (area indicating data distribution) was, in contrast, constructed on the basis of individual data points (non-averaged, 1 animals thus generated two data-points)

```{r, fig.width=8.8, fig.height=5.3}

suppressWarnings(suppressMessages( {
### Plotting P ----------------
groupquant<-sapply(post_fix_mg_hp_P[,c(5,6,1,7)],function(p) quantile(p, probs = c(0.025,0.975,0.5)))
groupquant<-exp(groupquant)

mg_hp$group<-factor(mg_hp$group,levels=c('ctrl.wt','eda.wt','ctrl.sca','eda.sca'))

par(mfrow=c(2,5))
par(mar=c(2,3,1,0))
par(mgp=c(1.9,0.6,0))
range<-c(0,100);scal<-range[2]-range[1]
xrange<-c(0.5,4.5);xscal=xrange[2]-xrange[1]
plot(NULL,xlim=c(xrange[1],xrange[2]),ylim=c(range[1],range[2]),xlab="",
     ylab="Respiration (pmol/s/mg) in hp",las=1, axes=FALSE,cex.lab=1.2)

rect(xrange[1],range[2],xrange[2],range[1],col="grey90",border=NA)
x<-range[1]
repeat{
  lines(c(xrange[1],xrange[2]),c(x,x),col="white",lwd=0.7)
  x=x+20;if(x>range[2]){break}}

x<-1
repeat{
  lines(c(x,x),c(range[1],range[2]),col="white",lwd=0.7)
  x=x+1;if(x>4.5){break}}

vioplot(mg_hp$P~mg_hp$group,col=colb,at=c(1:4),add=T,
        border=cola,axes=FALSE,drawRect=F,lwd=1,wex=0.8)

mg_hp_sum <- mg_hp %>% group_by(id, group, sex_num) %>% summarize(P = mean(P))


beeswarm(mg_hp_sum$P~mg_hp_sum$group,col=colc,at=c(1:4),
         add=T,pwpch=(16.5+mg_hp_sum$sex_num),
         corral = "wrap")
tp<-groupquant[3,]
xx<-1;wid=0.25
repeat{
  lines(c(xx-wid,xx+wid),c(tp[xx],tp[xx]),lwd=2,col="black");
  lines(c(xx,xx),c(groupquant[1,xx],groupquant[2,xx]),lwd=1.7,col="black")
  xx<-xx+1
  if(xx>4){break}}

tckk=-0.02
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=20),
     labels=c(rep("",length(seq(range[1],range[2],by=20)))),pos=xrange[1],tck=tckk)
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=20),pos=xrange[1],tck=tckk)

axis(side=1,las=1,cex.axis=1.1,at=c(seq(1,4,by=1)),
     labels=c(rep("",length(seq(1,4,by=1)))),pos=range[1],tck=tckk)
lines(c(xrange[1],xrange[2]),c(range[1],range[1]))
text(c(1:4),c(rep(range[1]-0.046*scal,4)),xpd=T,cex=1.1,col=cola,
     c("Wt","Wt", "SCA1", "SCA1"))
ypo<-c(range[1]-0.1*scal,range[1]-0.1*scal)
text(c(1:4),c(ypo[1],ypo[2],ypo[1],ypo[2]),xpd=T,cex=1.1,col=cola,
     c("0","edv", "0", "edv"))

ypos<-140;xpos=1.4
points(xpos,ypos,pch=16,cex=1.4,col=rgb(0.4,0.4,0.4,alpha=0.6))
text(xpos+0.25*xscal,ypos,"Females",col="grey40",cex=1.2)
points(xpos,ypos-0.08*scal,pch=17,cex=1.4,col=rgb(0.4,0.4,0.4,alpha=0.6))
text(xpos+0.25*xscal,ypos-0.08*scal,"Males",col="grey40",cex=1.2)
text(mean(xrange),range[2]+0.05*scal,"P I",cex=1.6,font=3,xpd=T)

### Plotting S ----------------
groupquant<-sapply(post_fix_mg_hp_S[,c(5,6,1,7)],function(p) quantile(p, probs = c(0.025,0.975,0.5)))
groupquant<-exp(groupquant)

range<-c(0,100);scal<-range[2]-range[1]
xrange<-c(0.5,4.5);xscal=xrange[2]-xrange[1]
plot(NULL,xlim=c(xrange[1],xrange[2]),ylim=c(range[1],range[2]),xlab="",
     ylab="",las=1, axes=FALSE,cex.lab=1.2)

rect(xrange[1],range[2],xrange[2],range[1],col="grey90",border=NA)
x<-range[1]
repeat{
  lines(c(xrange[1],xrange[2]),c(x,x),col="white",lwd=0.7)
  x=x+20;if(x>range[2]){break}}

x<-1
repeat{
  lines(c(x,x),c(range[1],range[2]),col="white",lwd=0.7)
  x=x+1;if(x>4.5){break}}

vioplot(mg_hp$S~mg_hp$group,col=colb,at=c(1:4),add=T,
        border=cola,axes=FALSE,drawRect=F,lwd=1,wex=0.8)


mg_hp_sum <- mg_hp %>% group_by(id, group, sex_num) %>% summarize(S = mean(S))


beeswarm(mg_hp_sum$S~mg_hp_sum$group,col=colc,at=c(1:4),
         add=T,pwpch=(16.5+mg_hp_sum$sex_num),
         corral = "wrap")

tp<-groupquant[3,]
xx<-1;wid=0.25
repeat{
  lines(c(xx-wid,xx+wid),c(tp[xx],tp[xx]),lwd=2,col="black");
  lines(c(xx,xx),c(groupquant[1,xx],groupquant[2,xx]),lwd=1.7,col="black")
  xx<-xx+1
  if(xx>4){break}}

tckk=-0.02
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=20),
     labels=c(rep("",length(seq(range[1],range[2],by=20)))),pos=xrange[1],tck=tckk)
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=20),pos=xrange[1],tck=tckk)

axis(side=1,las=1,cex.axis=1.1,at=c(seq(1,4,by=1)),
     labels=c(rep("",length(seq(1,4,by=1)))),pos=range[1],tck=tckk)
lines(c(xrange[1],xrange[2]),c(range[1],range[1]))
text(c(1:4),c(rep(range[1]-0.046*scal,4)),xpd=T,cex=1.1,col=cola,
     c("Wt","Wt", "SCA1", "SCA1"))
ypo<-c(range[1]-0.1*scal,range[1]-0.1*scal)
text(c(1:4),c(ypo[1],ypo[2],ypo[1],ypo[2]),xpd=T,cex=1.1,col=cola,
     c("0","edv", "0", "edv"))
text(mean(xrange),range[2]+0.05*scal,"P I+II",cex=1.6,font=3,xpd=T)

### Plotting Fccp ----------------
groupquant<-sapply(post_fix_mg_hp_Fccp[,c(5,6,1,7)],function(p) quantile(p, probs = c(0.025,0.975,0.5)))
groupquant<-exp(groupquant)


range<-c(0,200);scal<-range[2]-range[1]
xrange<-c(0.5,4.5);xscal=xrange[2]-xrange[1]
plot(NULL,xlim=c(xrange[1],xrange[2]),ylim=c(range[1],range[2]),xlab="",
     ylab="",las=1, axes=FALSE,cex.lab=1.2)

rect(xrange[1],range[2],xrange[2],range[1],col="grey90",border=NA)
x<-range[1]
repeat{
  lines(c(xrange[1],xrange[2]),c(x,x),col="white",lwd=0.7)
  x=x+20;if(x>range[2]){break}}

x<-1
repeat{
  lines(c(x,x),c(range[1],range[2]),col="white",lwd=0.7)
  x=x+1;if(x>4.5){break}}

vioplot(mg_hp$Fccp~mg_hp$group,col=colb,at=c(1:4),add=T,
        border=cola,axes=FALSE,drawRect=F,lwd=1,wex=0.8)

mg_hp_sum <- mg_hp %>% group_by(id, group, sex_num) %>% summarize(P = mean(Fccp))


beeswarm(mg_hp_sum$P~mg_hp_sum$group,col=colc,at=c(1:4),
         add=T,pwpch=(16.5+mg_hp_sum$sex_num),
         corral = "wrap")

tp<-groupquant[3,]
xx<-1;wid=0.25
repeat{
  lines(c(xx-wid,xx+wid),c(tp[xx],tp[xx]),lwd=2,col="black");
  lines(c(xx,xx),c(groupquant[1,xx],groupquant[2,xx]),lwd=1.7,col="black")
  xx<-xx+1
  if(xx>4){break}}

tckk=-0.02
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=20),
     labels=c(rep("",length(seq(range[1],range[2],by=20)))),pos=xrange[1],tck=tckk)
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=40),pos=xrange[1],tck=tckk)

axis(side=1,las=1,cex.axis=1.1,at=c(seq(1,4,by=1)),
     labels=c(rep("",length(seq(1,4,by=1)))),pos=range[1],tck=tckk)
lines(c(xrange[1],xrange[2]),c(range[1],range[1]))
text(c(1:4),c(rep(range[1]-0.046*scal,4)),xpd=T,cex=1.1,col=cola,
     c("Wt","Wt", "SCA1", "SCA1"))
ypo<-c(range[1]-0.1*scal,range[1]-0.1*scal)
text(c(1:4),c(ypo[1],ypo[2],ypo[1],ypo[2]),xpd=T,cex=1.1,col=cola,
     c("0","edv", "0", "edv"))
text(mean(xrange),range[2]+0.05*scal,"E I+II",cex=1.6,font=3,xpd=T)


### Plotting Rot ----------------
groupquant<-sapply(post_fix_mg_hp_Rot[,c(5,6,1,7)],function(p) quantile(p, probs = c(0.025,0.975,0.5)))
groupquant<-exp(groupquant)

range<-c(0,60);scal<-range[2]-range[1]
xrange<-c(0.5,4.5);xscal=xrange[2]-xrange[1]
plot(NULL,xlim=c(xrange[1],xrange[2]),ylim=c(range[1],range[2]),xlab="",
     ylab="",las=1, axes=FALSE,cex.lab=1.2)

rect(xrange[1],range[2],xrange[2],range[1],col="grey90",border=NA)
x<-range[1]
repeat{
  lines(c(xrange[1],xrange[2]),c(x,x),col="white",lwd=0.7)
  x=x+20;if(x>range[2]){break}}

x<-1
repeat{
  lines(c(x,x),c(range[1],range[2]),col="white",lwd=0.7)
  x=x+1;if(x>4.5){break}}

vioplot(mg_hp$Rot~mg_hp$group,col=colb,at=c(1:4),add=T,
        border=cola,axes=FALSE,drawRect=F,lwd=1,wex=0.8)

mg_hp_sum <- mg_hp %>% group_by(id, group, sex_num) %>% summarize(P = mean(Rot))


beeswarm(mg_hp_sum$P~mg_hp_sum$group,col=colc,at=c(1:4),
         add=T,pwpch=(16.5+mg_hp_sum$sex_num),
         corral = "wrap")

tp<-groupquant[3,]
xx<-1;wid=0.25
repeat{
  lines(c(xx-wid,xx+wid),c(tp[xx],tp[xx]),lwd=2,col="black");
  lines(c(xx,xx),c(groupquant[1,xx],groupquant[2,xx]),lwd=1.7,col="black")
  xx<-xx+1
  if(xx>4){break}}

tckk=-0.02
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=20),
     labels=c(rep("",length(seq(range[1],range[2],by=20)))),pos=xrange[1],tck=tckk)
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=20),pos=xrange[1],tck=tckk)

axis(side=1,las=1,cex.axis=1.1,at=c(seq(1,4,by=1)),
     labels=c(rep("",length(seq(1,4,by=1)))),pos=range[1],tck=tckk)
lines(c(xrange[1],xrange[2]),c(range[1],range[1]))
text(c(1:4),c(rep(range[1]-0.046*scal,4)),xpd=T,cex=1.1,col=cola,
     c("Wt","Wt", "SCA1", "SCA1"))
ypo<-c(range[1]-0.1*scal,range[1]-0.1*scal)
text(c(1:4),c(ypo[1],ypo[2],ypo[1],ypo[2]),xpd=T,cex=1.1,col=cola,
     c("0","edv", "0", "edv"))
text(mean(xrange),range[2]+0.05*scal,"E II",cex=1.6,font=3,xpd=T)


### Plotting Civ ----------------
groupquant<-sapply(post_fix_mg_hp_Civ[,c(5,6,1,7)],function(p) quantile(p, probs = c(0.025,0.975,0.5)))
groupquant<-exp(groupquant)


range<-c(0,400);scal<-range[2]-range[1]
xrange<-c(0.5,4.5);xscal=xrange[2]-xrange[1]
plot(NULL,xlim=c(xrange[1],xrange[2]),ylim=c(range[1],range[2]),xlab="",
     ylab="",las=1, axes=FALSE,cex.lab=1.2)

rect(xrange[1],range[2],xrange[2],range[1],col="grey90",border=NA)
x<-range[1]
repeat{
  lines(c(xrange[1],xrange[2]),c(x,x),col="white",lwd=0.7)
  x=x+20;if(x>range[2]){break}}

x<-1
repeat{
  lines(c(x,x),c(range[1],range[2]),col="white",lwd=0.7)
  x=x+1;if(x>4.5){break}}

vioplot(mg_hp$C_iv~mg_hp$group,col=colb,at=c(1:4),add=T,
        border=cola,axes=FALSE,drawRect=F,lwd=1,wex=0.8)

mg_hp_sum <- mg_hp %>% group_by(id, group, sex_num) %>% summarize(P = mean(C_iv))


beeswarm(mg_hp_sum$P~mg_hp_sum$group,col=colc,at=c(1:4),
         add=T,pwpch=(16.5+mg_hp_sum$sex_num),
         corral = "wrap")

tp<-groupquant[3,]
xx<-1;wid=0.25
repeat{
  lines(c(xx-wid,xx+wid),c(tp[xx],tp[xx]),lwd=2,col="black");
  lines(c(xx,xx),c(groupquant[1,xx],groupquant[2,xx]),lwd=1.7,col="black")
  xx<-xx+1
  if(xx>4){break}}

tckk=-0.02
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=20),
     labels=c(rep("",length(seq(range[1],range[2],by=20)))),pos=xrange[1],tck=tckk)
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=80),pos=xrange[1],tck=tckk)

axis(side=1,las=1,cex.axis=1.1,at=c(seq(1,4,by=1)),
     labels=c(rep("",length(seq(1,4,by=1)))),pos=range[1],tck=tckk)
lines(c(xrange[1],xrange[2]),c(range[1],range[1]))
text(c(1:4),c(rep(range[1]-0.046*scal,4)),xpd=T,cex=1.1,col=cola,
     c("Wt","Wt", "SCA1", "SCA1"))
ypo<-c(range[1]-0.1*scal,range[1]-0.1*scal)
text(c(1:4),c(ypo[1],ypo[2],ypo[1],ypo[2]),xpd=T,cex=1.1,col=cola,
     c("0","edv", "0", "edv"))
text(mean(xrange),range[2]+0.05*scal,"Complex IV",cex=1.6,font=3,xpd=T)

## probability distributions -------------
### PD - P ----------
par(mar=c(2,1,0,0))
dif<-data.frame(post_fix_mg_hp_P$wt_contrast,post_fix_mg_hp_P$b_P_groupeda.sca,
                post_fix_mg_hp_P$b_P_groupctrl.wt)
dif<-exp(dif)
yla<-"Fold-difference in respiration"
tckk=-0.018
ste<-seq(0.2,2.2,by=0.2)
mons_poste(dif,1)

zpos=seq(0,1,1/3)
xx=1;ind=0.5;xpol<-0.4;srt=55
text(xpol,zpos[xx]+zpos[2]*ind,
     "Wt: ed x 0 ",cex=1,srt=srt,xpd=T)
xx=xx+1

text(xpol,zpos[xx]+zpos[2]*ind,
     "SCA1: ed x 0 ",cex=1,srt=srt,xpd=T)
xx=xx+1

text(xpol,zpos[xx]+zpos[2]*ind,
     "0: Wt x SCA1",cex=1,srt=srt,xpd=T)

### PD - _S ----------
dif<-data.frame(post_fix_mg_hp_S$wt_contrast,post_fix_mg_hp_S$b_S_groupeda.sca,
                post_fix_mg_hp_S$b_S_groupctrl.wt)
dif<-exp(dif)
yla<-"Fold-difference in respiration"
tckk=-0.018
ste<-seq(0.2,2.2,by=0.2)
mons_poste(dif,1)

### PD - _Fccp ----------
dif<-data.frame(post_fix_mg_hp_Fccp$wt_contrast,post_fix_mg_hp_Fccp$b_Fccp_groupeda.sca,
                post_fix_mg_hp_Fccp$b_Fccp_groupctrl.wt)
dif<-exp(dif)
yla<-"Fold-difference in respiration"
tckk=-0.018
ste<-seq(0.2,2.2,by=0.2)
mons_poste(dif,1)

### PD - _Rot ----------
dif<-data.frame(post_fix_mg_hp_Rot$wt_contrast,post_fix_mg_hp_Rot$b_Rot_groupeda.sca,
                post_fix_mg_hp_Rot$b_Rot_groupctrl.wt)
dif<-exp(dif)
yla<-"Fold-difference in respiration"
tckk=-0.018
ste<-seq(0.2,1.7,by=0.2)
mons_poste(dif,1)

### PD - _Civ ----------
dif<-data.frame(post_fix_mg_hp_Civ$wt_contrast,post_fix_mg_hp_Civ$b_Civ_groupeda.sca,
                post_fix_mg_hp_Civ$b_Civ_groupctrl.wt)
dif<-exp(dif)
yla<-"Fold-difference in respiration"
tckk=-0.018
ste<-seq(0.6,2,by=0.2)
mons_poste(dif,1)
} ) )
```

# Cerebellum, weight standardization

## Data exploration

```{r, fig.heigth=7, fig.width=10}
par(mfrow=c(2,5))
par(mar=c(5,5,1,0))
par(mgp=c(3.6, 0.6,0))

## both sexes together
plot(mg_cb$P~mg_cb$group,
     col=cola, cex.axis=0.8, las=2)

plot(mg_cb$S~mg_cb$group,
     col=cola, cex.axis=0.8, las=2)

plot(mg_cb$Fccp~mg_cb$group,
     col=cola, cex.axis=0.8, las=2)

plot(mg_cb$Rot~mg_cb$group,
     col=cola, cex.axis=0.8, las=2)

plot(mg_cb$C_iv~mg_cb$group,
     col=cola, cex.axis=0.8, las=2)


## by both group and sex
plot(mg_cb$P~mg_cb$group_sex,
     col=cola[c(1,1,2,2,3,3,4,4)],cex.axis=0.8, las=2)

plot(mg_cb$S~mg_cb$group_sex,
     col=cola[c(1,1,2,2,3,3,4,4)],cex.axis=0.8, las=2)

plot(mg_cb$Fccp~mg_cb$group_sex,
     col=cola[c(1,1,2,2,3,3,4,4)],cex.axis=0.8, las=2)

plot(mg_cb$Rot~mg_cb$group_sex,
     col=cola[c(1,1,2,2,3,3,4,4)],cex.axis=0.8, las=2)

plot(mg_cb$C_iv~mg_cb$group_sex,
     col=cola[c(1,1,2,2,3,3,4,4)],cex.axis=0.8, las=2)
```
There seems to be consistent sex effect for *complex iv* respiration, but not in other parameters. As multivariate model will be fitted, and because it affects only one or two parameters, sex will be ignored. 

Spread seems to be higher in groups and parameters with larger median values, implying heteroscedasticity. Moreover, data distribution seems to be asymmetric, with most outliers being above median. From this reason, and also because the data are continuous and non-negative, we will employ gamma regression 


## Modelling

To model all 5 parameters (reflecting mitochondrial respiration capacity in difference phases of mitochondrial respiratory cycle) in a single model, we will fit multivariate regression. 

As there are technical replicates (two measurements per animal and brain region), we will apply hierarchical model with random intercept. 

### Setting priors



For simplicity, we will use default prior for intercept
```{r}
## re-leveling groups
mg_cb$group<-relevel(mg_cb$group,ref='ctrl.sca')

## formulas
bf_P<-bf(P~group+(1|id))
bf_S<-bf(S~group+(1|id))
bf_Fccp<-bf(Fccp~group+(1|id))
bf_Rot<-bf(Rot~group+(1|id))
bf_C_iv<-bf(C_iv~group+(1|id))

## prior setting
prior_1 <- get_prior(bf_P + bf_S + bf_Fccp + bf_Rot + bf_C_iv,
                     data = mg_cb, 
                     family=Gamma(link="log"))
prior_1

prior_1$prior[c(4,6,13,15,22,24,31,33,40,42)] <- "normal(0,2)"
prior_1$prior[c(5,14,23,32,41)] <- "normal(0,1.2)"
```

### Fitting the model
```{r}
mg_cb_model <- run_model(
          brm(bf_P+bf_S+bf_Fccp+bf_Rot+bf_C_iv,
              data=mg_cb, prior = prior_1,
              family=Gamma(link='log'),
              save_pars = save_pars(all = TRUE),
              iter=8000, warmup=2000,chains=2,cores=1,seed=17,
              control = list(adapt_delta = 0.99)),
             'output/brm/mg_cb_model', reuse = TRUE)

summary(mg_cb_model)
```
Rhat values and ESS are fine, model converged well. 

### PPC
```{r}
pp_check(mg_cb_model,type='dens_overlay',ndraws = 50,resp="P")
pp_check(mg_cb_model,type='dens_overlay_grouped',ndraws = 50,group='group',resp="P")
pp_check(mg_cb_model,type="stat_2d", stat = c("max", "min"),ndraws=100,resp="P")
pp_check(mg_cb_model,type="stat_2d", stat = c("mean", "sd"),ndraws=200,resp="P")

pp_check(mg_cb_model,type='dens_overlay',ndraws = 50,resp="S")
pp_check(mg_cb_model,type='dens_overlay_grouped',ndraws = 50,group='group',resp="S")
pp_check(mg_cb_model,type="stat_2d", stat = c("max", "min"),ndraws=100,resp="S")
pp_check(mg_cb_model,type="stat_2d", stat = c("mean", "sd"),ndraws=200,resp="S")

pp_check(mg_cb_model,type='dens_overlay',ndraws = 50,resp="Fccp")
pp_check(mg_cb_model,type='dens_overlay_grouped',ndraws = 50,group='group',resp="Fccp")
pp_check(mg_cb_model,type="stat_2d", stat = c("max", "min"),ndraws=100,resp="Fccp")
pp_check(mg_cb_model,type="stat_2d", stat = c("mean", "sd"),ndraws=200,resp="Fccp")

pp_check(mg_cb_model,type='dens_overlay',ndraws = 50,resp="Rot")
pp_check(mg_cb_model,type='dens_overlay_grouped',ndraws = 50,group='group',resp="Rot")
pp_check(mg_cb_model,type="stat_2d", stat = c("max", "min"),ndraws=100,resp="Rot")
pp_check(mg_cb_model,type="stat_2d", stat = c("mean", "sd"),ndraws=200,resp="Rot")

pp_check(mg_cb_model,type='dens_overlay',ndraws = 50,resp="Civ")
pp_check(mg_cb_model,type='dens_overlay_grouped',ndraws = 50,group='group',resp="Civ")
pp_check(mg_cb_model,type="stat_2d", stat = c("max", "min"),ndraws=100,resp="Civ")
pp_check(mg_cb_model,type="stat_2d", stat = c("mean", "sd"),ndraws=200,resp="Civ")
```
PPC looks fine, no serious issue detected. 

### Extraction of posterior samples
```{r}

post_fix_mg_cb_P <- as.data.frame(mg_cb_model, variable = c("b_P_Intercept","b_P_groupctrl.wt",
                                                      "b_P_groupeda.wt","b_P_groupeda.sca"))
names(post_fix_mg_cb_P)[1] <- "sca_ctrl"
post_fix_mg_cb_P$wt_ctrl <- post_fix_mg_cb_P$sca_ctrl+post_fix_mg_cb_P$b_P_groupctrl.wt
post_fix_mg_cb_P$wt_eda <- post_fix_mg_cb_P$sca_ctrl+post_fix_mg_cb_P$b_P_groupeda.wt
post_fix_mg_cb_P$sca_eda <- post_fix_mg_cb_P$sca_ctrl+post_fix_mg_cb_P$b_P_groupeda.sca
post_fix_mg_cb_P$wt_contrast <- post_fix_mg_cb_P$wt_eda-post_fix_mg_cb_P$wt_ctrl

post_fix_mg_cb_S <- as.data.frame(mg_cb_model, variable = c("b_S_Intercept","b_S_groupctrl.wt",
                                                          "b_S_groupeda.wt","b_S_groupeda.sca"))
names(post_fix_mg_cb_S)[1] <- "sca_ctrl"
post_fix_mg_cb_S$wt_ctrl <- post_fix_mg_cb_S$sca_ctrl+post_fix_mg_cb_S$b_S_groupctrl.wt
post_fix_mg_cb_S$wt_eda <- post_fix_mg_cb_S$sca_ctrl+post_fix_mg_cb_S$b_S_groupeda.wt
post_fix_mg_cb_S$sca_eda <- post_fix_mg_cb_S$sca_ctrl+post_fix_mg_cb_S$b_S_groupeda.sca
post_fix_mg_cb_S$wt_contrast <- post_fix_mg_cb_S$wt_eda-post_fix_mg_cb_S$wt_ctrl

post_fix_mg_cb_Fccp <- as.data.frame(mg_cb_model, variable = 
                                       c("b_Fccp_Intercept","b_Fccp_groupctrl.wt",
                                         "b_Fccp_groupeda.wt","b_Fccp_groupeda.sca"))
names(post_fix_mg_cb_Fccp)[1] <- "sca_ctrl"
post_fix_mg_cb_Fccp$wt_ctrl <- post_fix_mg_cb_Fccp$sca_ctrl+post_fix_mg_cb_Fccp$b_Fccp_groupctrl.wt
post_fix_mg_cb_Fccp$wt_eda <- post_fix_mg_cb_Fccp$sca_ctrl+post_fix_mg_cb_Fccp$b_Fccp_groupeda.wt
post_fix_mg_cb_Fccp$sca_eda <- post_fix_mg_cb_Fccp$sca_ctrl+post_fix_mg_cb_Fccp$b_Fccp_groupeda.sca
post_fix_mg_cb_Fccp$wt_contrast <- post_fix_mg_cb_Fccp$wt_eda-post_fix_mg_cb_Fccp$wt_ctrl

post_fix_mg_cb_Rot <- as.data.frame(mg_cb_model, variable = c("b_Rot_Intercept","b_Rot_groupctrl.wt",
                                                          "b_Rot_groupeda.wt","b_Rot_groupeda.sca"))
names(post_fix_mg_cb_Rot)[1] <- "sca_ctrl"
post_fix_mg_cb_Rot$wt_ctrl <- post_fix_mg_cb_Rot$sca_ctrl+post_fix_mg_cb_Rot$b_Rot_groupctrl.wt
post_fix_mg_cb_Rot$wt_eda <- post_fix_mg_cb_Rot$sca_ctrl+post_fix_mg_cb_Rot$b_Rot_groupeda.wt
post_fix_mg_cb_Rot$sca_eda <- post_fix_mg_cb_Rot$sca_ctrl+post_fix_mg_cb_Rot$b_Rot_groupeda.sca
post_fix_mg_cb_Rot$wt_contrast <- post_fix_mg_cb_Rot$wt_eda-post_fix_mg_cb_Rot$wt_ctrl

post_fix_mg_cb_Civ <- as.data.frame(mg_cb_model, variable = c("b_Civ_Intercept","b_Civ_groupctrl.wt",
                                                          "b_Civ_groupeda.wt","b_Civ_groupeda.sca"))
names(post_fix_mg_cb_Civ)[1] <- "sca_ctrl"
post_fix_mg_cb_Civ$wt_ctrl <- post_fix_mg_cb_Civ$sca_ctrl+post_fix_mg_cb_Civ$b_Civ_groupctrl.wt
post_fix_mg_cb_Civ$wt_eda <- post_fix_mg_cb_Civ$sca_ctrl+post_fix_mg_cb_Civ$b_Civ_groupeda.wt
post_fix_mg_cb_Civ$sca_eda <- post_fix_mg_cb_Civ$sca_ctrl+post_fix_mg_cb_Civ$b_Civ_groupeda.sca
post_fix_mg_cb_Civ$wt_contrast <- post_fix_mg_cb_Civ$wt_eda-post_fix_mg_cb_Civ$wt_ctrl
```

## Data and model visualization

In data visualization, individual points represent average per subject. Violin plot (area indicating data distribution) was, in contrast, constructed on the basis of individual data points (non-averaged, 1 animals thus generated two data-points)

```{r, fig.width=8.8, fig.height=5.3}

suppressWarnings(suppressMessages( {
### Plotting P ----------------
groupquant<-sapply(post_fix_mg_cb_P[,c(5,6,1,7)],
                   function(p) quantile(p, probs = c(0.025,0.975,0.5)))
groupquant<-exp(groupquant)

mg_cb$group<-factor(mg_cb$group,levels=c('ctrl.wt','eda.wt','ctrl.sca','eda.sca'))

#mat <- matrix(c(1:6,7:12),nrow = )

par(mfrow=c(2,5))
par(mar=c(2,3,1,0))
par(mgp=c(1.9,0.6,0))
range<-c(0,120);scal<-range[2]-range[1]
xrange<-c(0.5,4.5);xscal=xrange[2]-xrange[1]
plot(NULL,xlim=c(xrange[1],xrange[2]),ylim=c(range[1],range[2]),xlab="",
     ylab="Respiration (pmol/s/mg) in cb",las=1, axes=FALSE,cex.lab=1.2)

rect(xrange[1],range[2],xrange[2],range[1],col="grey90",border=NA)
x<-range[1]
repeat{
  lines(c(xrange[1],xrange[2]),c(x,x),col="white",lwd=0.7)
  x=x+20;if(x>range[2]){break}}

x<-1
repeat{
  lines(c(x,x),c(range[1],range[2]),col="white",lwd=0.7)
  x=x+1;if(x>4.5){break}}

vioplot(mg_cb$P~mg_cb$group,col=colb,at=c(1:4),add=T,
        border=cola,axes=FALSE,drawRect=F,lwd=1,wex=0.8)

mg_cb_sum <- mg_cb %>% group_by(id, group, sex_num) %>% summarize(P = mean(P))


beeswarm(mg_cb_sum$P~mg_cb_sum$group,col=colc,at=c(1:4),
         add=T,pwpch=(16.5+mg_cb_sum$sex_num),
         corral = "wrap")


tp<-groupquant[3,]
xx<-1;wid=0.25
repeat{
  lines(c(xx-wid,xx+wid),c(tp[xx],tp[xx]),lwd=2,col="black");
  lines(c(xx,xx),c(groupquant[1,xx],groupquant[2,xx]),lwd=1.7,col="black")
  xx<-xx+1
  if(xx>4){break}}

tckk=-0.02
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=20),
     labels=c(rep("",length(seq(range[1],range[2],by=20)))),pos=xrange[1],tck=tckk)
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=20),pos=xrange[1],tck=tckk)

axis(side=1,las=1,cex.axis=1.1,at=c(seq(1,4,by=1)),
     labels=c(rep("",length(seq(1,4,by=1)))),pos=range[1],tck=tckk)
lines(c(xrange[1],xrange[2]),c(range[1],range[1]))
text(c(1:4),c(rep(range[1]-0.046*scal,4)),xpd=T,cex=1.1,col=cola,
     c("Wt","Wt", "SCA1", "SCA1"))
ypo<-c(range[1]-0.1*scal,range[1]-0.1*scal)
text(c(1:4),c(ypo[1],ypo[2],ypo[1],ypo[2]),xpd=T,cex=1.1,col=cola,
     c("0","edv", "0", "edv"))

ypos<- 110 ;xpos=1.1
points(xpos,ypos,pch=16,cex=1.4,col=rgb(0.4,0.4,0.4,alpha=0.6))
text(xpos+0.25*xscal,ypos,"Females",col="grey40",cex=1.2)
points(xpos,ypos-0.08*scal,pch=17,cex=1.4,col=rgb(0.4,0.4,0.4,alpha=0.6))
text(xpos+0.25*xscal,ypos-0.08*scal,"Males",col="grey40",cex=1.2)
text(mean(xrange),range[2]+0.05*scal,"P I",cex=1.6,font=3,xpd=T)

### Plotting S ----------------
groupquant<-sapply(post_fix_mg_cb_S[,c(5,6,1,7)],function(p) quantile(p, probs = c(0.025,0.975,0.5)))
groupquant<-exp(groupquant)

range<-c(0,200);scal<-range[2]-range[1]
xrange<-c(0.5,4.5);xscal=xrange[2]-xrange[1]
plot(NULL,xlim=c(xrange[1],xrange[2]),ylim=c(range[1],range[2]),xlab="",
     ylab="",las=1, axes=FALSE,cex.lab=1.2)

rect(xrange[1],range[2],xrange[2],range[1],col="grey90",border=NA)
x<-range[1]
repeat{
  lines(c(xrange[1],xrange[2]),c(x,x),col="white",lwd=0.7)
  x=x+20;if(x>range[2]){break}}

x<-1
repeat{
  lines(c(x,x),c(range[1],range[2]),col="white",lwd=0.7)
  x=x+1;if(x>4.5){break}}

vioplot(mg_cb$S~mg_cb$group,col=colb,at=c(1:4),add=T,
        border=cola,axes=FALSE,drawRect=F,lwd=1,wex=0.8)

mg_cb_sum <- mg_cb %>% group_by(id, group, sex_num) %>% summarize(P = mean(S))


beeswarm(mg_cb_sum$P~mg_cb_sum$group,col=colc,at=c(1:4),
         add=T,pwpch=(16.5+mg_cb_sum$sex_num),
         corral = "wrap")

tp<-groupquant[3,]
xx<-1;wid=0.25
repeat{
  lines(c(xx-wid,xx+wid),c(tp[xx],tp[xx]),lwd=2,col="black");
  lines(c(xx,xx),c(groupquant[1,xx],groupquant[2,xx]),lwd=1.7,col="black")
  xx<-xx+1
  if(xx>4){break}}

tckk=-0.02
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=20),
     labels=c(rep("",length(seq(range[1],range[2],by=20)))),pos=xrange[1],tck=tckk)
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=40),pos=xrange[1],tck=tckk)

axis(side=1,las=1,cex.axis=1.1,at=c(seq(1,4,by=1)),
     labels=c(rep("",length(seq(1,4,by=1)))),pos=range[1],tck=tckk)
lines(c(xrange[1],xrange[2]),c(range[1],range[1]))
text(c(1:4),c(rep(range[1]-0.046*scal,4)),xpd=T,cex=1.1,col=cola,
     c("Wt","Wt", "SCA1", "SCA1"))
ypo<-c(range[1]-0.1*scal,range[1]-0.1*scal)
text(c(1:4),c(ypo[1],ypo[2],ypo[1],ypo[2]),xpd=T,cex=1.1,col=cola,
     c("0","edv", "0", "edv"))
text(mean(xrange),range[2]+0.05*scal,"P I+II",cex=1.6,font=3,xpd=T)

### Plotting Fccp ----------------
groupquant<-sapply(post_fix_mg_cb_Fccp[,c(5,6,1,7)],function(p) quantile(p, probs = c(0.025,0.975,0.5)))
groupquant<-exp(groupquant)


range<-c(0,240);scal<-range[2]-range[1]
xrange<-c(0.5,4.5);xscal=xrange[2]-xrange[1]
plot(NULL,xlim=c(xrange[1],xrange[2]),ylim=c(range[1],range[2]),xlab="",
     ylab="",las=1, axes=FALSE,cex.lab=1.2)

rect(xrange[1],range[2],xrange[2],range[1],col="grey90",border=NA)
x<-range[1]
repeat{
  lines(c(xrange[1],xrange[2]),c(x,x),col="white",lwd=0.7)
  x=x+20;if(x>range[2]){break}}

x<-1
repeat{
  lines(c(x,x),c(range[1],range[2]),col="white",lwd=0.7)
  x=x+1;if(x>4.5){break}}

vioplot(mg_cb$Fccp~mg_cb$group,col=colb,at=c(1:4),add=T,
        border=cola,axes=FALSE,drawRect=F,lwd=1,wex=0.8)

mg_cb_sum <- mg_cb %>% group_by(id, group, sex_num) %>% summarize(P = mean(Fccp))


beeswarm(mg_cb_sum$P~mg_cb_sum$group,col=colc,at=c(1:4),
         add=T,pwpch=(16.5+mg_cb_sum$sex_num),
         corral = "wrap")

tp<-groupquant[3,]
xx<-1;wid=0.25
repeat{
  lines(c(xx-wid,xx+wid),c(tp[xx],tp[xx]),lwd=2,col="black");
  lines(c(xx,xx),c(groupquant[1,xx],groupquant[2,xx]),lwd=1.7,col="black")
  xx<-xx+1
  if(xx>4){break}}

tckk=-0.02
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=20),
     labels=c(rep("",length(seq(range[1],range[2],by=20)))),pos=xrange[1],tck=tckk)
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=40),pos=xrange[1],tck=tckk)

axis(side=1,las=1,cex.axis=1.1,at=c(seq(1,4,by=1)),
     labels=c(rep("",length(seq(1,4,by=1)))),pos=range[1],tck=tckk)
lines(c(xrange[1],xrange[2]),c(range[1],range[1]))
text(c(1:4),c(rep(range[1]-0.046*scal,4)),xpd=T,cex=1.1,col=cola,
     c("Wt","Wt", "SCA1", "SCA1"))
ypo<-c(range[1]-0.1*scal,range[1]-0.1*scal)
text(c(1:4),c(ypo[1],ypo[2],ypo[1],ypo[2]),xpd=T,cex=1.1,col=cola,
     c("0","edv", "0", "edv"))
text(mean(xrange),range[2]+0.05*scal,"E I+II",cex=1.6,font=3,xpd=T)


### Plotting Rot ----------------
groupquant<-sapply(post_fix_mg_cb_Rot[,c(5,6,1,7)],function(p) quantile(p, probs = c(0.025,0.975,0.5)))
groupquant<-exp(groupquant)

range<-c(0,80);scal<-range[2]-range[1]
xrange<-c(0.5,4.5);xscal=xrange[2]-xrange[1]
plot(NULL,xlim=c(xrange[1],xrange[2]),ylim=c(range[1],range[2]),xlab="",
     ylab="",las=1, axes=FALSE,cex.lab=1.2)

rect(xrange[1],range[2],xrange[2],range[1],col="grey90",border=NA)
x<-range[1]
repeat{
  lines(c(xrange[1],xrange[2]),c(x,x),col="white",lwd=0.7)
  x=x+20;if(x>range[2]){break}}

x<-1
repeat{
  lines(c(x,x),c(range[1],range[2]),col="white",lwd=0.7)
  x=x+1;if(x>4.5){break}}

vioplot(mg_cb$Rot~mg_cb$group,col=colb,at=c(1:4),add=T,
        border=cola,axes=FALSE,drawRect=F,lwd=1,wex=0.8)

mg_cb_sum <- mg_cb %>% group_by(id, group, sex_num) %>% summarize(P = mean(Rot))


beeswarm(mg_cb_sum$P~mg_cb_sum$group,col=colc,at=c(1:4),
         add=T,pwpch=(16.5+mg_cb_sum$sex_num),
         corral = "wrap")

tp<-groupquant[3,]
xx<-1;wid=0.25
repeat{
  lines(c(xx-wid,xx+wid),c(tp[xx],tp[xx]),lwd=2,col="black");
  lines(c(xx,xx),c(groupquant[1,xx],groupquant[2,xx]),lwd=1.7,col="black")
  xx<-xx+1
  if(xx>4){break}}

tckk=-0.02
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=20),
     labels=c(rep("",length(seq(range[1],range[2],by=20)))),pos=xrange[1],tck=tckk)
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=20),pos=xrange[1],tck=tckk)

axis(side=1,las=1,cex.axis=1.1,at=c(seq(1,4,by=1)),
     labels=c(rep("",length(seq(1,4,by=1)))),pos=range[1],tck=tckk)
lines(c(xrange[1],xrange[2]),c(range[1],range[1]))
text(c(1:4),c(rep(range[1]-0.046*scal,4)),xpd=T,cex=1.1,col=cola,
     c("Wt","Wt", "SCA1", "SCA1"))
ypo<-c(range[1]-0.1*scal,range[1]-0.1*scal)
text(c(1:4),c(ypo[1],ypo[2],ypo[1],ypo[2]),xpd=T,cex=1.1,col=cola,
     c("0","edv", "0", "edv"))
text(mean(xrange),range[2]+0.05*scal,"E II",cex=1.6,font=3,xpd=T)


### Plotting Civ ----------------
groupquant<-sapply(post_fix_mg_cb_Civ[,c(5,6,1,7)],function(p) quantile(p, probs = c(0.025,0.975,0.5)))
groupquant<-exp(groupquant)

range<-c(0,500);scal<-range[2]-range[1]
xrange<-c(0.5,4.5);xscal=xrange[2]-xrange[1]
plot(NULL,xlim=c(xrange[1],xrange[2]),ylim=c(range[1],range[2]),xlab="",
     ylab="",las=1, axes=FALSE,cex.lab=1.2)

rect(xrange[1],range[2],xrange[2],range[1],col="grey90",border=NA)
x<-range[1]
repeat{
  lines(c(xrange[1],xrange[2]),c(x,x),col="white",lwd=0.7)
  x=x+20;if(x>range[2]){break}}

x<-1
repeat{
  lines(c(x,x),c(range[1],range[2]),col="white",lwd=0.7)
  x=x+1;if(x>4.5){break}}

vioplot(mg_cb$C_iv~mg_cb$group,col=colb,at=c(1:4),add=T,
        border=cola,axes=FALSE,drawRect=F,lwd=1,wex=0.8)

mg_cb_sum <- mg_cb %>% group_by(id, group, sex_num) %>% summarize(P = mean(C_iv))


beeswarm(mg_cb_sum$P~mg_cb_sum$group,col=colc,at=c(1:4),
         add=T,pwpch=(16.5+mg_cb_sum$sex_num),
         corral = "wrap")

tp<-groupquant[3,]
xx<-1;wid=0.25
repeat{
  lines(c(xx-wid,xx+wid),c(tp[xx],tp[xx]),lwd=2,col="black");
  lines(c(xx,xx),c(groupquant[1,xx],groupquant[2,xx]),lwd=1.7,col="black")
  xx<-xx+1
  if(xx>4){break}}

tckk=-0.02
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=20),
     labels=c(rep("",length(seq(range[1],range[2],by=20)))),pos=xrange[1],tck=tckk)
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=100),pos=xrange[1],tck=tckk)

axis(side=1,las=1,cex.axis=1.1,at=c(seq(1,4,by=1)),
     labels=c(rep("",length(seq(1,4,by=1)))),pos=range[1],tck=tckk)
lines(c(xrange[1],xrange[2]),c(range[1],range[1]))
text(c(1:4),c(rep(range[1]-0.046*scal,4)),xpd=T,cex=1.1,col=cola,
     c("Wt","Wt", "SCA1", "SCA1"))
ypo<-c(range[1]-0.1*scal,range[1]-0.1*scal)
text(c(1:4),c(ypo[1],ypo[2],ypo[1],ypo[2]),xpd=T,cex=1.1,col=cola,
     c("0","edv", "0", "edv"))
text(mean(xrange),range[2]+0.05*scal,"Complex IV",cex=1.6,font=3,xpd=T)

## probability distributions -------------
### PD - P ----------
par(mar=c(2,1,0,0))
dif<-data.frame(post_fix_mg_cb_P$wt_contrast,post_fix_mg_cb_P$b_P_groupeda.sca,
                post_fix_mg_cb_P$b_P_groupctrl.wt)
dif<-exp(dif)
yla<-"Fold-difference in respiration"
tckk=-0.018
ste<-seq(0.2,2.2,by=0.2)
mons_poste(dif,1)

zpos=seq(0,1,1/3)
xx=1;ind=0.5;xpol<-0.4;srt=55
text(xpol,zpos[xx]+zpos[2]*ind,
     "Wt: ed x 0 ",cex=1,srt=srt,xpd=T)
xx=xx+1

text(xpol,zpos[xx]+zpos[2]*ind,
     "SCA1: ed x 0 ",cex=1,srt=srt,xpd=T)
xx=xx+1

text(xpol,zpos[xx]+zpos[2]*ind,
     "0: Wt x SCA1",cex=1,srt=srt,xpd=T)

### PD - _S ----------
dif<-data.frame(post_fix_mg_cb_S$wt_contrast,post_fix_mg_cb_S$b_S_groupeda.sca,
                post_fix_mg_cb_S$b_S_groupctrl.wt)
dif<-exp(dif)
yla<-"Fold-difference in respiration"
tckk=-0.018
ste<-seq(0.2,2.2,by=0.2)
mons_poste(dif,1)

### PD - _Fccp ----------
dif<-data.frame(post_fix_mg_cb_Fccp$wt_contrast,post_fix_mg_cb_Fccp$b_Fccp_groupeda.sca,
                post_fix_mg_cb_Fccp$b_Fccp_groupctrl.wt)
dif<-exp(dif)
yla<-"Fold-difference in respiration"
tckk=-0.018
ste<-seq(0.2,2.2,by=0.2)
mons_poste(dif,1)

### PD - _Rot ----------
dif<-data.frame(post_fix_mg_cb_Rot$wt_contrast,post_fix_mg_cb_Rot$b_Rot_groupeda.sca,
                post_fix_mg_cb_Rot$b_Rot_groupctrl.wt)
dif<-exp(dif)
yla<-"Fold-difference in respiration"
tckk=-0.018
ste<-seq(0.2,1.7,by=0.2)
mons_poste(dif,1)

### PD - _Civ ----------
dif<-data.frame(post_fix_mg_cb_Civ$wt_contrast,post_fix_mg_cb_Civ$b_Civ_groupeda.sca,
                post_fix_mg_cb_Civ$b_Civ_groupctrl.wt)
dif<-exp(dif)
yla<-"Fold-difference in respiration"
tckk=-0.018
ste<-seq(0.6,2,by=0.2)
mons_poste(dif,1)

} ) )
```

# Hippocampus, citrate standardization


## Data exploration

```{r, fig.heigth=7, fig.width=10}
par(mfrow=c(2,5))
par(mar=c(5,5,1,0))
par(mgp=c(3.6, 0.6,0))

## both sexes together
plot(cs_hp$P~cs_hp$group,
     col=cola, cex.axis=0.8, las=2)

plot(cs_hp$S~cs_hp$group,
     col=cola, cex.axis=0.8, las=2)

plot(cs_hp$Fccp~cs_hp$group,
     col=cola, cex.axis=0.8, las=2)

plot(cs_hp$Rot~cs_hp$group,
     col=cola, cex.axis=0.8, las=2)

plot(cs_hp$C_iv~cs_hp$group,
     col=cola, cex.axis=0.8, las=2)


## by both group and sex
plot(cs_hp$P~cs_hp$group_sex,
     col=cola[c(1,1,2,2,3,3,4,4)],cex.axis=0.8, las=2)

plot(cs_hp$S~cs_hp$group_sex,
     col=cola[c(1,1,2,2,3,3,4,4)],cex.axis=0.8, las=2)

plot(cs_hp$Fccp~cs_hp$group_sex,
     col=cola[c(1,1,2,2,3,3,4,4)],cex.axis=0.8, las=2)

plot(cs_hp$Rot~cs_hp$group_sex,
     col=cola[c(1,1,2,2,3,3,4,4)],cex.axis=0.8, las=2)

plot(cs_hp$C_iv~cs_hp$group_sex,
     col=cola[c(1,1,2,2,3,3,4,4)],cex.axis=0.8, las=2)
```
No consistent sex effect. Data distribution seems to be more symmetrical than for weight-standardized respirtation, but we will keep gamma regression for consistency. 

## Modelling

### Setting priors

Although we measured mitochondrial respiration in our previous publication ([Tichanek et al., 2020](https://www.nature.com/articles/s41598-020-62308-0)), context was different in the sense that previous publication used group-housed mice not undergoing any test or manipulation. In contrast, these data are from mice which have been tested in behavioral tests and which were handled regularly. 

For simplicity, we will use default prior for intercept
```{r}
## re-leveling groups
cs_hp$group<-relevel(cs_hp$group,ref='ctrl.sca')

## formulas
bf_P<-bf(P~group+(1|id))
bf_S<-bf(S~group+(1|id))
bf_Fccp<-bf(Fccp~group+(1|id))
bf_Rot<-bf(Rot~group+(1|id))
bf_C_iv<-bf(C_iv~group+(1|id))

## prior setting
prior_1 <- get_prior(bf_P + bf_S + bf_Fccp + bf_Rot + bf_C_iv,
                     data = cs_hp, 
                     family=Gamma(link="log"))
prior_1

prior_1$prior[c(4,6,13,15,22,24,31,33,40,42)] <- "normal(0,2)"
prior_1$prior[c(5,14,23,32,41)] <- "normal(0,1.2)"
```

### Fitting the model
```{r}
cs_hp_model <- run_model(
          brm(bf_P+bf_S+bf_Fccp+bf_Rot+bf_C_iv,
              data=cs_hp, prior = prior_1,
              family=Gamma(link='log'),
              save_pars = save_pars(all = TRUE),
              iter=8000, warmup=2000,chains=2,cores=1,seed=17,
              control = list(adapt_delta = 0.99)),
             'output/brm/cs_hp_model', reuse = TRUE)

summary(cs_hp_model)
```
Rhat values and ESS are fine, model converged well. 

### PPC
```{r}
pp_check(cs_hp_model,type='dens_overlay',ndraws = 50,resp="P")
pp_check(cs_hp_model,type='dens_overlay_grouped',ndraws = 50,group='group',resp="P")
pp_check(cs_hp_model,type="stat_2d", stat = c("max", "min"),ndraws=100,resp="P")
pp_check(cs_hp_model,type="stat_2d", stat = c("mean", "sd"),ndraws=200,resp="P")

pp_check(cs_hp_model,type='dens_overlay',ndraws = 50,resp="S")
pp_check(cs_hp_model,type='dens_overlay_grouped',ndraws = 50,group='group',resp="S")
pp_check(cs_hp_model,type="stat_2d", stat = c("max", "min"),ndraws=100,resp="S")
pp_check(cs_hp_model,type="stat_2d", stat = c("mean", "sd"),ndraws=200,resp="S")

pp_check(cs_hp_model,type='dens_overlay',ndraws = 50,resp="Fccp")
pp_check(cs_hp_model,type='dens_overlay_grouped',ndraws = 50,group='group',resp="Fccp")
pp_check(cs_hp_model,type="stat_2d", stat = c("max", "min"),ndraws=100,resp="Fccp")
pp_check(cs_hp_model,type="stat_2d", stat = c("mean", "sd"),ndraws=200,resp="Fccp")

pp_check(cs_hp_model,type='dens_overlay',ndraws = 50,resp="Rot")
pp_check(cs_hp_model,type='dens_overlay_grouped',ndraws = 50,group='group',resp="Rot")
pp_check(cs_hp_model,type="stat_2d", stat = c("max", "min"),ndraws=100,resp="Rot")
pp_check(cs_hp_model,type="stat_2d", stat = c("mean", "sd"),ndraws=200,resp="Rot")

pp_check(cs_hp_model,type='dens_overlay',ndraws = 50,resp="Civ")
pp_check(cs_hp_model,type='dens_overlay_grouped',ndraws = 50,group='group',resp="Civ")
pp_check(cs_hp_model,type="stat_2d", stat = c("max", "min"),ndraws=100,resp="Civ")
pp_check(cs_hp_model,type="stat_2d", stat = c("mean", "sd"),ndraws=200,resp="Civ")
```
PPC looks generally fine, no serious issue detected. As in previous parts, minimal values are smaller than is predicted, suggesting below-outliers occurrence (technical issues with some replicates or wrong isolation of grey tissue from white nerves??) 

### Extraction of posterior samples
```{r}

post_fix_cs_hp_P <- as.data.frame(
  cs_hp_model, variable = c("b_P_Intercept","b_P_groupctrl.wt",
                            "b_P_groupeda.wt","b_P_groupeda.sca"))
names(post_fix_cs_hp_P)[1] <- "sca_ctrl"
post_fix_cs_hp_P$wt_ctrl <- post_fix_cs_hp_P$sca_ctrl+post_fix_cs_hp_P$b_P_groupctrl.wt
post_fix_cs_hp_P$wt_eda <- post_fix_cs_hp_P$sca_ctrl+post_fix_cs_hp_P$b_P_groupeda.wt
post_fix_cs_hp_P$sca_eda <- post_fix_cs_hp_P$sca_ctrl+post_fix_cs_hp_P$b_P_groupeda.sca
post_fix_cs_hp_P$wt_contrast <- post_fix_cs_hp_P$wt_eda-post_fix_cs_hp_P$wt_ctrl

post_fix_cs_hp_S <- as.data.frame(cs_hp_model, variable =
                                    c("b_S_Intercept","b_S_groupctrl.wt",
                                      "b_S_groupeda.wt","b_S_groupeda.sca"))
names(post_fix_cs_hp_S)[1] <- "sca_ctrl"
post_fix_cs_hp_S$wt_ctrl <- post_fix_cs_hp_S$sca_ctrl+post_fix_cs_hp_S$b_S_groupctrl.wt
post_fix_cs_hp_S$wt_eda <- post_fix_cs_hp_S$sca_ctrl+post_fix_cs_hp_S$b_S_groupeda.wt
post_fix_cs_hp_S$sca_eda <- post_fix_cs_hp_S$sca_ctrl+post_fix_cs_hp_S$b_S_groupeda.sca
post_fix_cs_hp_S$wt_contrast <- post_fix_cs_hp_S$wt_eda-post_fix_cs_hp_S$wt_ctrl

post_fix_cs_hp_Fccp <- as.data.frame(cs_hp_model, variable = 
                                       c("b_Fccp_Intercept","b_Fccp_groupctrl.wt",
                                         "b_Fccp_groupeda.wt","b_Fccp_groupeda.sca"))
names(post_fix_cs_hp_Fccp)[1] <- "sca_ctrl"
post_fix_cs_hp_Fccp$wt_ctrl <- post_fix_cs_hp_Fccp$sca_ctrl+post_fix_cs_hp_Fccp$b_Fccp_groupctrl.wt
post_fix_cs_hp_Fccp$wt_eda <- post_fix_cs_hp_Fccp$sca_ctrl+post_fix_cs_hp_Fccp$b_Fccp_groupeda.wt
post_fix_cs_hp_Fccp$sca_eda <- post_fix_cs_hp_Fccp$sca_ctrl+post_fix_cs_hp_Fccp$b_Fccp_groupeda.sca
post_fix_cs_hp_Fccp$wt_contrast <- post_fix_cs_hp_Fccp$wt_eda-post_fix_cs_hp_Fccp$wt_ctrl

post_fix_cs_hp_Rot <- as.data.frame(cs_hp_model, 
                                    variable = c("b_Rot_Intercept","b_Rot_groupctrl.wt",
                                                 "b_Rot_groupeda.wt","b_Rot_groupeda.sca"))
names(post_fix_cs_hp_Rot)[1] <- "sca_ctrl"
post_fix_cs_hp_Rot$wt_ctrl <- post_fix_cs_hp_Rot$sca_ctrl+
  post_fix_cs_hp_Rot$b_Rot_groupctrl.wt
post_fix_cs_hp_Rot$wt_eda <- post_fix_cs_hp_Rot$sca_ctrl+
  post_fix_cs_hp_Rot$b_Rot_groupeda.wt
post_fix_cs_hp_Rot$sca_eda <- post_fix_cs_hp_Rot$sca_ctrl + post_fix_cs_hp_Rot$b_Rot_groupeda.sca
post_fix_cs_hp_Rot$wt_contrast <- post_fix_cs_hp_Rot$wt_eda-post_fix_cs_hp_Rot$wt_ctrl

post_fix_cs_hp_Civ <- as.data.frame(cs_hp_model, 
                                    variable = c("b_Civ_Intercept","b_Civ_groupctrl.wt",
                                               "b_Civ_groupeda.wt","b_Civ_groupeda.sca"))
names(post_fix_cs_hp_Civ)[1] <- "sca_ctrl"
post_fix_cs_hp_Civ$wt_ctrl <- post_fix_cs_hp_Civ$sca_ctrl+post_fix_cs_hp_Civ$b_Civ_groupctrl.wt
post_fix_cs_hp_Civ$wt_eda <- post_fix_cs_hp_Civ$sca_ctrl+post_fix_cs_hp_Civ$b_Civ_groupeda.wt
post_fix_cs_hp_Civ$sca_eda <- post_fix_cs_hp_Civ$sca_ctrl +
  post_fix_cs_hp_Civ$b_Civ_groupeda.sca
post_fix_cs_hp_Civ$wt_contrast <- post_fix_cs_hp_Civ$wt_eda-post_fix_cs_hp_Civ$wt_ctrl
```

## Data and model visualization

In data visualization, individual points represent average per subject. Violin plot (area indicating data distribution) was, in contrast, constructed on the basis of individual data points (non-averaged, 1 animals thus generated two data-points)

```{r, fig.width=8.8, fig.height=5.3}

suppressWarnings(suppressMessages( {
### Plotting P ----------------
groupquant<-sapply(post_fix_cs_hp_P[,c(5,6,1,7)],function(p) quantile(p, probs = c(0.025,0.975,0.5)))
groupquant<-exp(groupquant)

cs_hp$group<-factor(cs_hp$group,levels=c('ctrl.wt','eda.wt','ctrl.sca','eda.sca'))


par(mfrow=c(2,5))
par(mar=c(2,2.6,1,0))
par(mgp=c(1.5,0.6,0))
range<-c(0,6);scal<-range[2]-range[1]
xrange<-c(0.5,4.5);xscal=xrange[2]-xrange[1]
plot(NULL,xlim=c(xrange[1],xrange[2]),ylim=c(range[1],range[2]),xlab="",
     ylab="Respiration per CS (umol/s/IU) in hp",las=1, axes=FALSE,cex.lab=1.2)
rect(xrange[1],range[2],xrange[2],range[1],col="grey90",border=NA)
x<-range[1]
repeat{
  lines(c(xrange[1],xrange[2]),c(x,x),col="white",lwd=0.7)
  x=x+3;if(x>range[2]){break}}

x<-1
repeat{
  lines(c(x,x),c(range[1],range[2]),col="white",lwd=0.7)
  x=x+1;if(x>4.5){break}}

vioplot(cs_hp$P~cs_hp$group,col=colb,at=c(1:4),add=T,
        border=cola,axes=FALSE,drawRect=F,lwd=1,wex=0.8)

mg_cb_sum <- cs_hp %>% group_by(id, group, sex_num) %>% summarize(P = mean(P))


beeswarm(mg_cb_sum$P~mg_cb_sum$group,col=colc,at=c(1:4),
         add=T,pwpch=(16.5+mg_cb_sum$sex_num),
         corral = "wrap")

tp<-groupquant[3,]
xx<-1;wid=0.25
repeat{
  lines(c(xx-wid,xx+wid),c(tp[xx],tp[xx]),lwd=2,col="black");
  lines(c(xx,xx),c(groupquant[1,xx],groupquant[2,xx]),lwd=1.7,col="black")
  xx<-xx+1
  if(xx>4){break}}

tckk=-0.02
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=3),
     labels=c(rep("",length(seq(range[1],range[2],by=3)))),pos=xrange[1],tck=tckk)
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=3),pos=xrange[1],tck=tckk)

axis(side=1,las=1,cex.axis=1.1,at=c(seq(1,4,by=1)),
     labels=c(rep("",length(seq(1,4,by=1)))),pos=range[1],tck=tckk)
lines(c(xrange[1],xrange[2]),c(range[1],range[1]))
text(c(1:4),c(rep(range[1]-0.046*scal,4)),xpd=T,cex=1.1,col=cola,
     c("Wt","Wt", "SCA1", "SCA1"))
ypo<-c(range[1]-0.1*scal,range[1]-0.1*scal)
text(c(1:4),c(ypo[1],ypo[2],ypo[1],ypo[2]),xpd=T,cex=1.1,col=cola,
     c("0","edv", "0", "edv"))

ypos<- 5.5 ;xpos=1.1
points(xpos,ypos,pch=16,cex=1.4,col=rgb(0.4,0.4,0.4,alpha=0.6))
text(xpos+0.25*xscal,ypos,"Females",col="grey40",cex=1.2)
points(xpos,ypos-0.08*scal,pch=17,cex=1.4,col=rgb(0.4,0.4,0.4,alpha=0.6))
text(xpos+0.25*xscal,ypos-0.08*scal,"Males",col="grey40",cex=1.2)
text(mean(xrange),range[2]+0.05*scal,"P I",cex=1.6,font=3,xpd=T)

### Plotting S ----------------
groupquant<-sapply(post_fix_cs_hp_S[,c(5,6,1,7)],function(p) quantile(p, probs = c(0.025,0.975,0.5)))
groupquant<-exp(groupquant)

cs_hp$group<-factor(cs_hp$group,levels=c('ctrl.wt','eda.wt','ctrl.sca','eda.sca'))


range<-c(0,9);scal<-range[2]-range[1]
xrange<-c(0.5,4.5);xscal=xrange[2]-xrange[1]
plot(NULL,xlim=c(xrange[1],xrange[2]),ylim=c(range[1],range[2]),xlab="",
     ylab="",las=1, axes=FALSE,cex.lab=1.2)

rect(xrange[1],range[2],xrange[2],range[1],col="grey90",border=NA)
x<-range[1]
repeat{
  lines(c(xrange[1],xrange[2]),c(x,x),col="white",lwd=0.7)
  x=x+3;if(x>range[2]){break}}

x<-1
repeat{
  lines(c(x,x),c(range[1],range[2]),col="white",lwd=0.7)
  x=x+1;if(x>4.5){break}}

vioplot(cs_hp$S~cs_hp$group,col=colb,at=c(1:4),add=T,
        border=cola,axes=FALSE,drawRect=F,lwd=1,wex=0.8)

mg_cb_sum <- cs_hp %>% group_by(id, group, sex_num) %>% summarize(P = mean(S))


beeswarm(mg_cb_sum$P~mg_cb_sum$group,col=colc,at=c(1:4),
         add=T,pwpch=(16.5+mg_cb_sum$sex_num),
         corral = "wrap")


tp<-groupquant[3,]
xx<-1;wid=0.25
repeat{
  lines(c(xx-wid,xx+wid),c(tp[xx],tp[xx]),lwd=2,col="black");
  lines(c(xx,xx),c(groupquant[1,xx],groupquant[2,xx]),lwd=1.7,col="black")
  xx<-xx+1
  if(xx>4){break}}

tckk=-0.02
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=3),
     labels=c(rep("",length(seq(range[1],range[2],by=3)))),pos=xrange[1],tck=tckk)
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=3),pos=xrange[1],tck=tckk)

axis(side=1,las=1,cex.axis=1.1,at=c(seq(1,4,by=1)),
     labels=c(rep("",length(seq(1,4,by=1)))),pos=range[1],tck=tckk)
lines(c(xrange[1],xrange[2]),c(range[1],range[1]))
text(c(1:4),c(rep(range[1]-0.046*scal,4)),xpd=T,cex=1.1,col=cola,
     c("Wt","Wt", "SCA1", "SCA1"))
ypo<-c(range[1]-0.1*scal,range[1]-0.1*scal)
text(c(1:4),c(ypo[1],ypo[2],ypo[1],ypo[2]),xpd=T,cex=1.1,col=cola,
     c("0","edv", "0", "edv"))
text(mean(xrange),range[2]+0.05*scal,"P I+II",cex=1.6,font=3,xpd=T)

### Plotting Fccp ----------------
groupquant<-sapply(post_fix_cs_hp_Fccp[,c(5,6,1,7)],function(p) quantile(p, probs = c(0.025,0.975,0.5)))
groupquant<-exp(groupquant)

cs_hp$group<-factor(cs_hp$group,levels=c('ctrl.wt','eda.wt','ctrl.sca','eda.sca'))


range<-c(0,12);scal<-range[2]-range[1]
xrange<-c(0.5,4.5);xscal=xrange[2]-xrange[1]
plot(NULL,xlim=c(xrange[1],xrange[2]),ylim=c(range[1],range[2]),xlab="",
     ylab="",las=1, axes=FALSE,cex.lab=1.2)

rect(xrange[1],range[2],xrange[2],range[1],col="grey90",border=NA)
x<-range[1]
repeat{
  lines(c(xrange[1],xrange[2]),c(x,x),col="white",lwd=0.7)
  x=x+3;if(x>range[2]){break}}

x<-1
repeat{
  lines(c(x,x),c(range[1],range[2]),col="white",lwd=0.7)
  x=x+1;if(x>4.5){break}}

vioplot(cs_hp$Fccp~cs_hp$group,col=colb,at=c(1:4),add=T,
        border=cola,axes=FALSE,drawRect=F,lwd=1,wex=0.8)

mg_cb_sum <- cs_hp %>% group_by(id, group, sex_num) %>% summarize(P = mean(Fccp))

beeswarm(mg_cb_sum$P~mg_cb_sum$group,col=colc,at=c(1:4),
         add=T,pwpch=(16.5+mg_cb_sum$sex_num),
         corral = "wrap")

tp<-groupquant[3,]
xx<-1;wid=0.25
repeat{
  lines(c(xx-wid,xx+wid),c(tp[xx],tp[xx]),lwd=2,col="black");
  lines(c(xx,xx),c(groupquant[1,xx],groupquant[2,xx]),lwd=1.7,col="black")
  xx<-xx+1
  if(xx>4){break}}

tckk=-0.02
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=3),
     labels=c(rep("",length(seq(range[1],range[2],by=3)))),pos=xrange[1],tck=tckk)
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=3),pos=xrange[1],tck=tckk)

axis(side=1,las=1,cex.axis=1.1,at=c(seq(1,4,by=1)),
     labels=c(rep("",length(seq(1,4,by=1)))),pos=range[1],tck=tckk)
lines(c(xrange[1],xrange[2]),c(range[1],range[1]))
text(c(1:4),c(rep(range[1]-0.046*scal,4)),xpd=T,cex=1.1,col=cola,
     c("Wt","Wt", "SCA1", "SCA1"))
ypo<-c(range[1]-0.1*scal,range[1]-0.1*scal)
text(c(1:4),c(ypo[1],ypo[2],ypo[1],ypo[2]),xpd=T,cex=1.1,col=cola,
     c("0","edv", "0", "edv"))
text(mean(xrange),range[2]+0.05*scal,"E I+II",cex=1.6,font=3,xpd=T)


### Plotting Rot ----------------
groupquant<-sapply(post_fix_cs_hp_Rot[,c(5,6,1,7)],function(p) quantile(p, probs = c(0.025,0.975,0.5)))
groupquant<-exp(groupquant)

cs_hp$group<-factor(cs_hp$group,levels=c('ctrl.wt','eda.wt','ctrl.sca','eda.sca'))


range<-c(0,6);scal<-range[2]-range[1]
xrange<-c(0.5,4.5);xscal=xrange[2]-xrange[1]
plot(NULL,xlim=c(xrange[1],xrange[2]),ylim=c(range[1],range[2]),xlab="",
     ylab="",las=1, axes=FALSE,cex.lab=1.2)

rect(xrange[1],range[2],xrange[2],range[1],col="grey90",border=NA)
x<-range[1]
repeat{
  lines(c(xrange[1],xrange[2]),c(x,x),col="white",lwd=0.7)
  x=x+3;if(x>range[2]){break}}

x<-1
repeat{
  lines(c(x,x),c(range[1],range[2]),col="white",lwd=0.7)
  x=x+1;if(x>4.5){break}}

vioplot(cs_hp$Rot~cs_hp$group,col=colb,at=c(1:4),add=T,
        border=cola,axes=FALSE,drawRect=F,lwd=1,wex=0.8)

mg_cb_sum <- cs_hp %>% group_by(id, group, sex_num) %>% summarize(P = mean(Rot))


beeswarm(mg_cb_sum$P~mg_cb_sum$group,col=colc,at=c(1:4),
         add=T,pwpch=(16.5+mg_cb_sum$sex_num),
         corral = "wrap")

tp<-groupquant[3,]
xx<-1;wid=0.25
repeat{
  lines(c(xx-wid,xx+wid),c(tp[xx],tp[xx]),lwd=2,col="black");
  lines(c(xx,xx),c(groupquant[1,xx],groupquant[2,xx]),lwd=1.7,col="black")
  xx<-xx+1
  if(xx>4){break}}

tckk=-0.02
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=3),
     labels=c(rep("",length(seq(range[1],range[2],by=3)))),pos=xrange[1],tck=tckk)
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=3),pos=xrange[1],tck=tckk)

axis(side=1,las=1,cex.axis=1.1,at=c(seq(1,4,by=1)),
     labels=c(rep("",length(seq(1,4,by=1)))),pos=range[1],tck=tckk)
lines(c(xrange[1],xrange[2]),c(range[1],range[1]))
text(c(1:4),c(rep(range[1]-0.046*scal,4)),xpd=T,cex=1.1,col=cola,
     c("Wt","Wt", "SCA1", "SCA1"))
ypo<-c(range[1]-0.1*scal,range[1]-0.1*scal)
text(c(1:4),c(ypo[1],ypo[2],ypo[1],ypo[2]),xpd=T,cex=1.1,col=cola,
     c("0","edv", "0", "edv"))
text(mean(xrange),range[2]+0.05*scal,"E II",cex=1.6,font=3,xpd=T)


### Plotting Civ ----------------
groupquant<-sapply(post_fix_cs_hp_Civ[,c(5,6,1,7)],function(p) quantile(p, probs = c(0.025,0.975,0.5)))
groupquant<-exp(groupquant)

cs_hp$group<-factor(cs_hp$group,levels=c('ctrl.wt','eda.wt','ctrl.sca','eda.sca'))


range<-c(0,36);scal<-range[2]-range[1]
xrange<-c(0.5,4.5);xscal=xrange[2]-xrange[1]
plot(NULL,xlim=c(xrange[1],xrange[2]),ylim=c(range[1],range[2]),xlab="",
     ylab="",las=1, axes=FALSE,cex.lab=1.2)

rect(xrange[1],range[2],xrange[2],range[1],col="grey90",border=NA)
x<-range[1]
repeat{
  lines(c(xrange[1],xrange[2]),c(x,x),col="white",lwd=0.7)
  x=x+3;if(x>range[2]){break}}

x<-1
repeat{
  lines(c(x,x),c(range[1],range[2]),col="white",lwd=0.7)
  x=x+1;if(x>4.5){break}}

vioplot(cs_hp$C_iv~cs_hp$group,col=colb,at=c(1:4),add=T,
        border=cola,axes=FALSE,drawRect=F,lwd=1,wex=0.8)

mg_cb_sum <- cs_hp %>% group_by(id, group, sex_num) %>% summarize(P = mean(C_iv))


beeswarm(mg_cb_sum$P~mg_cb_sum$group,col=colc,at=c(1:4),
         add=T,pwpch=(16.5+mg_cb_sum$sex_num),
         corral = "wrap")

tp<-groupquant[3,]
xx<-1;wid=0.25
repeat{
  lines(c(xx-wid,xx+wid),c(tp[xx],tp[xx]),lwd=2,col="black");
  lines(c(xx,xx),c(groupquant[1,xx],groupquant[2,xx]),lwd=1.7,col="black")
  xx<-xx+1
  if(xx>4){break}}

tckk=-0.02
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=3),
     labels=c(rep("",length(seq(range[1],range[2],by=3)))),pos=xrange[1],tck=tckk)
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=6),pos=xrange[1],tck=tckk)

axis(side=1,las=1,cex.axis=1.1,at=c(seq(1,4,by=1)),
     labels=c(rep("",length(seq(1,4,by=1)))),pos=range[1],tck=tckk)
lines(c(xrange[1],xrange[2]),c(range[1],range[1]))
text(c(1:4),c(rep(range[1]-0.046*scal,4)),xpd=T,cex=1.1,col=cola,
     c("Wt","Wt", "SCA1", "SCA1"))
ypo<-c(range[1]-0.1*scal,range[1]-0.1*scal)
text(c(1:4),c(ypo[1],ypo[2],ypo[1],ypo[2]),xpd=T,cex=1.1,col=cola,
     c("0","edv", "0", "edv"))
text(mean(xrange),range[2]+0.05*scal,"Complex IV",cex=1.6,font=3,xpd=T)

## probability distributions -------------
### PD - P ----------
par(mar=c(2,1,0,0))
dif<-data.frame(post_fix_cs_hp_P$wt_contrast,post_fix_cs_hp_P$b_P_groupeda.sca,
                post_fix_cs_hp_P$b_P_groupctrl.wt)
dif<-exp(dif)
yla<-"Fold-difference in respiration"
tckk=-0.018
ste<-seq(0.2,2.2,by=0.2)
mons_poste(dif,1)

zpos=seq(0,1,1/3)
xx=1;ind=0.5;xpol<-0.4;srt=55
text(xpol,zpos[xx]+zpos[2]*ind,
     "Wt: ed x 0 ",cex=1,srt=srt,xpd=T)
xx=xx+1

text(xpol,zpos[xx]+zpos[2]*ind,
     "SCA1: ed x 0 ",cex=1,srt=srt,xpd=T)
xx=xx+1

text(xpol,zpos[xx]+zpos[2]*ind,
     "0: Wt x SCA1",cex=1,srt=srt,xpd=T)

### PD - _S ----------
dif<-data.frame(post_fix_cs_hp_S$wt_contrast,post_fix_cs_hp_S$b_S_groupeda.sca,
                post_fix_cs_hp_S$b_S_groupctrl.wt)
dif<-exp(dif)
yla<-"Fold-difference in respiration"
tckk=-0.018
ste<-seq(0.2,2.2,by=0.2)
mons_poste(dif,1)

### PD - _Fccp ----------
dif<-data.frame(post_fix_cs_hp_Fccp$wt_contrast,post_fix_cs_hp_Fccp$b_Fccp_groupeda.sca,
                post_fix_cs_hp_Fccp$b_Fccp_groupctrl.wt)
dif<-exp(dif)
yla<-"Fold-difference in respiration"
tckk=-0.018
ste<-seq(0.2,2.2,by=0.2)
mons_poste(dif,1)

### PD - _Rot ----------
dif<-data.frame(post_fix_cs_hp_Rot$wt_contrast,post_fix_cs_hp_Rot$b_Rot_groupeda.sca,
                post_fix_cs_hp_Rot$b_Rot_groupctrl.wt)
dif<-exp(dif)
yla<-"Fold-difference in respiration"
tckk=-0.018
ste<-seq(0.2,2.2,by=0.2)
mons_poste(dif,1)

### PD - _Civ ----------
dif<-data.frame(post_fix_cs_hp_Civ$wt_contrast,post_fix_cs_hp_Civ$b_Civ_groupeda.sca,
                post_fix_cs_hp_Civ$b_Civ_groupctrl.wt)
dif<-exp(dif)
yla<-"Fold-difference in respiration"
tckk=-0.018
ste<-seq(0.2,2.1,by=0.2)
mons_poste(dif,1)
} ) )
```

# Cerebellum, citrate standardization


## Data exploration

```{r, fig.heigth=7, fig.width=10}
par(mfrow=c(2,5))
par(mar=c(5,5,1,0))
par(mgp=c(3.6, 0.6,0))

## both sexes together
plot(cs_cb$P~cs_cb$group,
     col=cola, cex.axis=0.8, las=2)

plot(cs_cb$S~cs_cb$group,
     col=cola, cex.axis=0.8, las=2)

plot(cs_cb$Fccp~cs_cb$group,
     col=cola, cex.axis=0.8, las=2)

plot(cs_cb$Rot~cs_cb$group,
     col=cola, cex.axis=0.8, las=2)

plot(cs_cb$C_iv~cs_cb$group,
     col=cola, cex.axis=0.8, las=2)


## by both group and sex
plot(cs_cb$P~cs_cb$group_sex,
     col=cola[c(1,1,2,2,3,3,4,4)],cex.axis=0.8, las=2)

plot(cs_cb$S~cs_cb$group_sex,
     col=cola[c(1,1,2,2,3,3,4,4)],cex.axis=0.8, las=2)

plot(cs_cb$Fccp~cs_cb$group_sex,
     col=cola[c(1,1,2,2,3,3,4,4)],cex.axis=0.8, las=2)

plot(cs_cb$Rot~cs_cb$group_sex,
     col=cola[c(1,1,2,2,3,3,4,4)],cex.axis=0.8, las=2)

plot(cs_cb$C_iv~cs_cb$group_sex,
     col=cola[c(1,1,2,2,3,3,4,4)],cex.axis=0.8, las=2)
```
No consistent sex effect. Data distribution seems again more asymmetrical compared to hp data. Gamma seems more appropriate and will be used. Sex will be ignored

## Modelling

### Setting priors

Although we measured mitochondrial respiration in our previous publication ([Tichanek et al., 2020](https://www.nature.com/articles/s41598-020-62308-0)), context was different in the sense that previous publication used group-housed mice not undergoing any test or manipulation. In contrast, these data are from mice which have been tested in behavioral tests and which were handled regularly. 

For simplicity, we will use default prior for intercept
```{r}
## re-leveling groups
cs_cb$group<-relevel(cs_cb$group,ref='ctrl.sca')

## formulas
bf_P<-bf(P~group+(1|id))
bf_S<-bf(S~group+(1|id))
bf_Fccp<-bf(Fccp~group+(1|id))
bf_Rot<-bf(Rot~group+(1|id))
bf_C_iv<-bf(C_iv~group+(1|id))

## prior setting
prior_1 <- get_prior(bf_P + bf_S + bf_Fccp + bf_Rot + bf_C_iv,
                     data = cs_cb, 
                     family=Gamma(link="log"))
prior_1

prior_1$prior[c(4,6,13,15,22,24,31,33,40,42)] <- "normal(0,2)"
prior_1$prior[c(5,14,23,32,41)] <- "normal(0,1.2)"
```

### Fitting the model
```{r}
cs_cb_model <- run_model(
          brm(bf_P+bf_S+bf_Fccp+bf_Rot+bf_C_iv,
              data=cs_cb, prior = prior_1,
              family=Gamma(link='log'),
              save_pars = save_pars(all = TRUE),
              iter=8000, warmup=2000,chains=2,cores=1,seed=17,
              control = list(adapt_delta = 0.99)),
             'output/brm/cs_cb_model', reuse = TRUE)

summary(cs_cb_model)
```
Rhat values and ESS are fine, model converged well. 

### PPC
```{r}
pp_check(cs_cb_model,type='dens_overlay',ndraws = 50,resp="P")
pp_check(cs_cb_model,type='dens_overlay_grouped',ndraws = 50,group='group',resp="P")
pp_check(cs_cb_model,type="stat_2d", stat = c("max", "min"),ndraws=100,resp="P")
pp_check(cs_cb_model,type="stat_2d", stat = c("mean", "sd"),ndraws=200,resp="P")

pp_check(cs_cb_model,type='dens_overlay',ndraws = 50,resp="S")
pp_check(cs_cb_model,type='dens_overlay_grouped',ndraws = 50,group='group',resp="S")
pp_check(cs_cb_model,type="stat_2d", stat = c("max", "min"),ndraws=100,resp="S")
pp_check(cs_cb_model,type="stat_2d", stat = c("mean", "sd"),ndraws=200,resp="S")

pp_check(cs_cb_model,type='dens_overlay',ndraws = 50,resp="Fccp")
pp_check(cs_cb_model,type='dens_overlay_grouped',ndraws = 50,group='group',resp="Fccp")
pp_check(cs_cb_model,type="stat_2d", stat = c("max", "min"),ndraws=100,resp="Fccp")
pp_check(cs_cb_model,type="stat_2d", stat = c("mean", "sd"),ndraws=200,resp="Fccp")

pp_check(cs_cb_model,type='dens_overlay',ndraws = 50,resp="Rot")
pp_check(cs_cb_model,type='dens_overlay_grouped',ndraws = 50,group='group',resp="Rot")
pp_check(cs_cb_model,type="stat_2d", stat = c("max", "min"),ndraws=100,resp="Rot")
pp_check(cs_cb_model,type="stat_2d", stat = c("mean", "sd"),ndraws=200,resp="Rot")

pp_check(cs_cb_model,type='dens_overlay',ndraws = 50,resp="Civ")
pp_check(cs_cb_model,type='dens_overlay_grouped',ndraws = 50,group='group',resp="Civ")
pp_check(cs_cb_model,type="stat_2d", stat = c("max", "min"),ndraws=100,resp="Civ")
pp_check(cs_cb_model,type="stat_2d", stat = c("mean", "sd"),ndraws=200,resp="Civ")
```
PPC looks generally fine, no serious issue detected. Occurrence of unexpectedly low minimal values is OK here. 

### Extraction of posterior samples
```{r}

post_fix_cs_cb_P <- as.data.frame(
  cs_cb_model, variable = c("b_P_Intercept","b_P_groupctrl.wt",
                            "b_P_groupeda.wt","b_P_groupeda.sca"))
names(post_fix_cs_cb_P)[1] <- "sca_ctrl"
post_fix_cs_cb_P$wt_ctrl <- post_fix_cs_cb_P$sca_ctrl+post_fix_cs_cb_P$b_P_groupctrl.wt
post_fix_cs_cb_P$wt_eda <- post_fix_cs_cb_P$sca_ctrl+post_fix_cs_cb_P$b_P_groupeda.wt
post_fix_cs_cb_P$sca_eda <- post_fix_cs_cb_P$sca_ctrl+post_fix_cs_cb_P$b_P_groupeda.sca
post_fix_cs_cb_P$wt_contrast <- post_fix_cs_cb_P$wt_eda-post_fix_cs_cb_P$wt_ctrl

post_fix_cs_cb_S <- as.data.frame(cs_cb_model, variable =
                                    c("b_S_Intercept","b_S_groupctrl.wt",
                                      "b_S_groupeda.wt","b_S_groupeda.sca"))
names(post_fix_cs_cb_S)[1] <- "sca_ctrl"
post_fix_cs_cb_S$wt_ctrl <- post_fix_cs_cb_S$sca_ctrl+post_fix_cs_cb_S$b_S_groupctrl.wt
post_fix_cs_cb_S$wt_eda <- post_fix_cs_cb_S$sca_ctrl+post_fix_cs_cb_S$b_S_groupeda.wt
post_fix_cs_cb_S$sca_eda <- post_fix_cs_cb_S$sca_ctrl+post_fix_cs_cb_S$b_S_groupeda.sca
post_fix_cs_cb_S$wt_contrast <- post_fix_cs_cb_S$wt_eda-post_fix_cs_cb_S$wt_ctrl

post_fix_cs_cb_Fccp <- as.data.frame(cs_cb_model, variable = 
                                       c("b_Fccp_Intercept","b_Fccp_groupctrl.wt",
                                         "b_Fccp_groupeda.wt","b_Fccp_groupeda.sca"))
names(post_fix_cs_cb_Fccp)[1] <- "sca_ctrl"
post_fix_cs_cb_Fccp$wt_ctrl <- post_fix_cs_cb_Fccp$sca_ctrl+post_fix_cs_cb_Fccp$b_Fccp_groupctrl.wt
post_fix_cs_cb_Fccp$wt_eda <- post_fix_cs_cb_Fccp$sca_ctrl+post_fix_cs_cb_Fccp$b_Fccp_groupeda.wt
post_fix_cs_cb_Fccp$sca_eda <- post_fix_cs_cb_Fccp$sca_ctrl+post_fix_cs_cb_Fccp$b_Fccp_groupeda.sca
post_fix_cs_cb_Fccp$wt_contrast <- post_fix_cs_cb_Fccp$wt_eda-post_fix_cs_cb_Fccp$wt_ctrl

post_fix_cs_cb_Rot <- as.data.frame(cs_cb_model, 
                                    variable = c("b_Rot_Intercept","b_Rot_groupctrl.wt",
                                                 "b_Rot_groupeda.wt","b_Rot_groupeda.sca"))
names(post_fix_cs_cb_Rot)[1] <- "sca_ctrl"
post_fix_cs_cb_Rot$wt_ctrl <- post_fix_cs_cb_Rot$sca_ctrl+
  post_fix_cs_cb_Rot$b_Rot_groupctrl.wt
post_fix_cs_cb_Rot$wt_eda <- post_fix_cs_cb_Rot$sca_ctrl+
  post_fix_cs_cb_Rot$b_Rot_groupeda.wt
post_fix_cs_cb_Rot$sca_eda <- post_fix_cs_cb_Rot$sca_ctrl + post_fix_cs_cb_Rot$b_Rot_groupeda.sca
post_fix_cs_cb_Rot$wt_contrast <- post_fix_cs_cb_Rot$wt_eda-post_fix_cs_cb_Rot$wt_ctrl

post_fix_cs_cb_Civ <- as.data.frame(cs_cb_model, 
                                    variable = c("b_Civ_Intercept","b_Civ_groupctrl.wt",
                                               "b_Civ_groupeda.wt","b_Civ_groupeda.sca"))
names(post_fix_cs_cb_Civ)[1] <- "sca_ctrl"
post_fix_cs_cb_Civ$wt_ctrl <- post_fix_cs_cb_Civ$sca_ctrl+post_fix_cs_cb_Civ$b_Civ_groupctrl.wt
post_fix_cs_cb_Civ$wt_eda <- post_fix_cs_cb_Civ$sca_ctrl+post_fix_cs_cb_Civ$b_Civ_groupeda.wt
post_fix_cs_cb_Civ$sca_eda <- post_fix_cs_cb_Civ$sca_ctrl +
  post_fix_cs_cb_Civ$b_Civ_groupeda.sca
post_fix_cs_cb_Civ$wt_contrast <- post_fix_cs_cb_Civ$wt_eda-post_fix_cs_cb_Civ$wt_ctrl
```

## Data and model visualization

In data visualization, individual points represent average per subject. Violin plot (area indicating data distribution) was, in contrast, constructed on the basis of individual data points (non-averaged, 1 animals thus generated two data-points)

```{r, fig.width=8.8, fig.height=5.3}

suppressWarnings(suppressMessages( {
### Plotting P ----------------
groupquant<-sapply(post_fix_cs_cb_P[,c(5,6,1,7)],function(p) quantile(p, probs = c(0.025,0.975,0.5)))
groupquant<-exp(groupquant)

cs_cb$group<-factor(cs_cb$group,levels=c('ctrl.wt','eda.wt','ctrl.sca','eda.sca'))



par(mfrow=c(2,5))
par(mar=c(2,2.6,1,0))
par(mgp=c(1.5,0.6,0))
range<-c(0,12);scal<-range[2]-range[1]
xrange<-c(0.5,4.5);xscal=xrange[2]-xrange[1]
plot(NULL,xlim=c(xrange[1],xrange[2]),ylim=c(range[1],range[2]),xlab="",
     ylab="Respiration per CS (umol/s/IU) in cb",las=1, axes=FALSE,cex.lab=1.2)

rect(xrange[1],range[2],xrange[2],range[1],col="grey90",border=NA)
x<-range[1]
repeat{
  lines(c(xrange[1],xrange[2]),c(x,x),col="white",lwd=0.7)
  x=x+3;if(x>range[2]){break}}

x<-1
repeat{
  lines(c(x,x),c(range[1],range[2]),col="white",lwd=0.7)
  x=x+1;if(x>4.5){break}}

vioplot(cs_cb$P~cs_cb$group,col=colb,at=c(1:4),add=T,
        border=cola,axes=FALSE,drawRect=F,lwd=1,wex=0.8)

mg_cb_sum <- cs_cb %>% group_by(id, group, sex_num) %>% summarize(P = mean(P))

beeswarm(mg_cb_sum$P~mg_cb_sum$group,col=colc,at=c(1:4),
         add=T,pwpch=(16.5+mg_cb_sum$sex_num),
         corral = "wrap")


tp<-groupquant[3,]
xx<-1;wid=0.25
repeat{
  lines(c(xx-wid,xx+wid),c(tp[xx],tp[xx]),lwd=2,col="black");
  lines(c(xx,xx),c(groupquant[1,xx],groupquant[2,xx]),lwd=1.7,col="black")
  xx<-xx+1
  if(xx>4){break}}

tckk=-0.02
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=3),
     labels=c(rep("",length(seq(range[1],range[2],by=3)))),pos=xrange[1],tck=tckk)
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=3),pos=xrange[1],tck=tckk)

axis(side=1,las=1,cex.axis=1.1,at=c(seq(1,4,by=1)),
     labels=c(rep("",length(seq(1,4,by=1)))),pos=range[1],tck=tckk)
lines(c(xrange[1],xrange[2]),c(range[1],range[1]))
text(c(1:4),c(rep(range[1]-0.046*scal,4)),xpd=T,cex=1.1,col=cola,
     c("Wt","Wt", "SCA1", "SCA1"))
ypo<-c(range[1]-0.1*scal,range[1]-0.1*scal)
text(c(1:4),c(ypo[1],ypo[2],ypo[1],ypo[2]),xpd=T,cex=1.1,col=cola,
     c("0","edv", "0", "edv"))

ypos<- 11.5 ;xpos=1.1
points(xpos,ypos,pch=16,cex=1.4,col=rgb(0.4,0.4,0.4,alpha=0.6))
text(xpos+0.25*xscal,ypos,"Females",col="grey40",cex=1.2)
points(xpos,ypos-0.08*scal,pch=17,cex=1.4,col=rgb(0.4,0.4,0.4,alpha=0.6))
text(xpos+0.25*xscal,ypos-0.08*scal,"Males",col="grey40",cex=1.2)
text(mean(xrange),range[2]+0.05*scal,"P I",cex=1.6,font=3,xpd=T)

### Plotting S ----------------
groupquant<-sapply(post_fix_cs_cb_S[,c(5,6,1,7)],function(p) quantile(p, probs = c(0.025,0.975,0.5)))
groupquant<-exp(groupquant)

cs_cb$group<-factor(cs_cb$group,levels=c('ctrl.wt','eda.wt','ctrl.sca','eda.sca'))


range<-c(0,15);scal<-range[2]-range[1]
xrange<-c(0.5,4.5);xscal=xrange[2]-xrange[1]
plot(NULL,xlim=c(xrange[1],xrange[2]),ylim=c(range[1],range[2]),xlab="",
     ylab="",las=1, axes=FALSE,cex.lab=1.2)

rect(xrange[1],range[2],xrange[2],range[1],col="grey90",border=NA)
x<-range[1]
repeat{
  lines(c(xrange[1],xrange[2]),c(x,x),col="white",lwd=0.7)
  x=x+3;if(x>range[2]){break}}

x<-1
repeat{
  lines(c(x,x),c(range[1],range[2]),col="white",lwd=0.7)
  x=x+1;if(x>4.5){break}}

vioplot(cs_cb$S~cs_cb$group,col=colb,at=c(1:4),add=T,
        border=cola,axes=FALSE,drawRect=F,lwd=1,wex=0.8)

mg_cb_sum <- cs_cb %>% group_by(id, group, sex_num) %>% summarize(P = mean(S))

beeswarm(mg_cb_sum$P~mg_cb_sum$group,col=colc,at=c(1:4),
         add=T,pwpch=(16.5+mg_cb_sum$sex_num),
         corral = "wrap")

tp<-groupquant[3,]
xx<-1;wid=0.25
repeat{
  lines(c(xx-wid,xx+wid),c(tp[xx],tp[xx]),lwd=2,col="black");
  lines(c(xx,xx),c(groupquant[1,xx],groupquant[2,xx]),lwd=1.7,col="black")
  xx<-xx+1
  if(xx>4){break}}

tckk=-0.02
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=3),
     labels=c(rep("",length(seq(range[1],range[2],by=3)))),pos=xrange[1],tck=tckk)
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=3),pos=xrange[1],tck=tckk)

axis(side=1,las=1,cex.axis=1.1,at=c(seq(1,4,by=1)),
     labels=c(rep("",length(seq(1,4,by=1)))),pos=range[1],tck=tckk)
lines(c(xrange[1],xrange[2]),c(range[1],range[1]))
text(c(1:4),c(rep(range[1]-0.046*scal,4)),xpd=T,cex=1.1,col=cola,
     c("Wt","Wt", "SCA1", "SCA1"))
ypo<-c(range[1]-0.1*scal,range[1]-0.1*scal)
text(c(1:4),c(ypo[1],ypo[2],ypo[1],ypo[2]),xpd=T,cex=1.1,col=cola,
     c("0","edv", "0", "edv"))
text(mean(xrange),range[2]+0.05*scal,"P I+II",cex=1.6,font=3,xpd=T)

### Plotting Fccp ----------------
groupquant<-sapply(post_fix_cs_cb_Fccp[,c(5,6,1,7)],function(p) quantile(p, probs = c(0.025,0.975,0.5)))
groupquant<-exp(groupquant)

cs_cb$group<-factor(cs_cb$group,levels=c('ctrl.wt','eda.wt','ctrl.sca','eda.sca'))


range<-c(0,21);scal<-range[2]-range[1]
xrange<-c(0.5,4.5);xscal=xrange[2]-xrange[1]
plot(NULL,xlim=c(xrange[1],xrange[2]),ylim=c(range[1],range[2]),xlab="",
     ylab="",las=1, axes=FALSE,cex.lab=1.2)

rect(xrange[1],range[2],xrange[2],range[1],col="grey90",border=NA)
x<-range[1]
repeat{
  lines(c(xrange[1],xrange[2]),c(x,x),col="white",lwd=0.7)
  x=x+3;if(x>range[2]){break}}

x<-1
repeat{
  lines(c(x,x),c(range[1],range[2]),col="white",lwd=0.7)
  x=x+1;if(x>4.5){break}}

vioplot(cs_cb$Fccp~cs_cb$group,col=colb,at=c(1:4),add=T,
        border=cola,axes=FALSE,drawRect=F,lwd=1,wex=0.8)

mg_cb_sum <- cs_cb %>% group_by(id, group, sex_num) %>% summarize(P = mean(Fccp))

beeswarm(mg_cb_sum$P~mg_cb_sum$group,col=colc,at=c(1:4),
         add=T,pwpch=(16.5+mg_cb_sum$sex_num),
         corral = "wrap")

tp<-groupquant[3,]
xx<-1;wid=0.25
repeat{
  lines(c(xx-wid,xx+wid),c(tp[xx],tp[xx]),lwd=2,col="black");
  lines(c(xx,xx),c(groupquant[1,xx],groupquant[2,xx]),lwd=1.7,col="black")
  xx<-xx+1
  if(xx>4){break}}

tckk=-0.02
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=3),
     labels=c(rep("",length(seq(range[1],range[2],by=3)))),pos=xrange[1],tck=tckk)
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=3),pos=xrange[1],tck=tckk)

axis(side=1,las=1,cex.axis=1.1,at=c(seq(1,4,by=1)),
     labels=c(rep("",length(seq(1,4,by=1)))),pos=range[1],tck=tckk)
lines(c(xrange[1],xrange[2]),c(range[1],range[1]))
text(c(1:4),c(rep(range[1]-0.046*scal,4)),xpd=T,cex=1.1,col=cola,
     c("Wt","Wt", "SCA1", "SCA1"))
ypo<-c(range[1]-0.1*scal,range[1]-0.1*scal)
text(c(1:4),c(ypo[1],ypo[2],ypo[1],ypo[2]),xpd=T,cex=1.1,col=cola,
     c("0","edv", "0", "edv"))
text(mean(xrange),range[2]+0.05*scal,"E I+II",cex=1.6,font=3,xpd=T)


### Plotting Rot ----------------
groupquant<-sapply(post_fix_cs_cb_Rot[,c(5,6,1,7)],function(p) quantile(p, probs = c(0.025,0.975,0.5)))
groupquant<-exp(groupquant)

cs_cb$group<-factor(cs_cb$group,levels=c('ctrl.wt','eda.wt','ctrl.sca','eda.sca'))


range<-c(0,9);scal<-range[2]-range[1]
xrange<-c(0.5,4.5);xscal=xrange[2]-xrange[1]
plot(NULL,xlim=c(xrange[1],xrange[2]),ylim=c(range[1],range[2]),xlab="",
     ylab="",las=1, axes=FALSE,cex.lab=1.2)

rect(xrange[1],range[2],xrange[2],range[1],col="grey90",border=NA)
x<-range[1]
repeat{
  lines(c(xrange[1],xrange[2]),c(x,x),col="white",lwd=0.7)
  x=x+3;if(x>range[2]){break}}

x<-1
repeat{
  lines(c(x,x),c(range[1],range[2]),col="white",lwd=0.7)
  x=x+1;if(x>4.5){break}}

vioplot(cs_cb$Rot~cs_cb$group,col=colb,at=c(1:4),add=T,
        border=cola,axes=FALSE,drawRect=F,lwd=1,wex=0.8)

mg_cb_sum <- cs_cb %>% group_by(id, group, sex_num) %>% summarize(P = mean(Rot))

beeswarm(mg_cb_sum$P~mg_cb_sum$group,col=colc,at=c(1:4),
         add=T,pwpch=(16.5+mg_cb_sum$sex_num),
         corral = "wrap")

tp<-groupquant[3,]
xx<-1;wid=0.25
repeat{
  lines(c(xx-wid,xx+wid),c(tp[xx],tp[xx]),lwd=2,col="black");
  lines(c(xx,xx),c(groupquant[1,xx],groupquant[2,xx]),lwd=1.7,col="black")
  xx<-xx+1
  if(xx>4){break}}

tckk=-0.02
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=3),
     labels=c(rep("",length(seq(range[1],range[2],by=3)))),pos=xrange[1],tck=tckk)
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=3),pos=xrange[1],tck=tckk)

axis(side=1,las=1,cex.axis=1.1,at=c(seq(1,4,by=1)),
     labels=c(rep("",length(seq(1,4,by=1)))),pos=range[1],tck=tckk)
lines(c(xrange[1],xrange[2]),c(range[1],range[1]))
text(c(1:4),c(rep(range[1]-0.046*scal,4)),xpd=T,cex=1.1,col=cola,
     c("Wt","Wt", "SCA1", "SCA1"))
ypo<-c(range[1]-0.1*scal,range[1]-0.1*scal)
text(c(1:4),c(ypo[1],ypo[2],ypo[1],ypo[2]),xpd=T,cex=1.1,col=cola,
     c("0","edv", "0", "edv"))
text(mean(xrange),range[2]+0.05*scal,"E II",cex=1.6,font=3,xpd=T)


### Plotting Civ ----------------
groupquant<-sapply(post_fix_cs_cb_Civ[,c(5,6,1,7)],function(p) quantile(p, probs = c(0.025,0.975,0.5)))
groupquant<-exp(groupquant)

cs_cb$group<-factor(cs_cb$group,levels=c('ctrl.wt','eda.wt','ctrl.sca','eda.sca'))


range<-c(0,54);scal<-range[2]-range[1]
xrange<-c(0.5,4.5);xscal=xrange[2]-xrange[1]
plot(NULL,xlim=c(xrange[1],xrange[2]),ylim=c(range[1],range[2]),xlab="",
     ylab="",las=1, axes=FALSE,cex.lab=1.2)

rect(xrange[1],range[2],xrange[2],range[1],col="grey90",border=NA)
x<-range[1]
repeat{
  lines(c(xrange[1],xrange[2]),c(x,x),col="white",lwd=0.7)
  x=x+3;if(x>range[2]){break}}

x<-1
repeat{
  lines(c(x,x),c(range[1],range[2]),col="white",lwd=0.7)
  x=x+1;if(x>4.5){break}}

vioplot(cs_cb$C_iv~cs_cb$group,col=colb,at=c(1:4),add=T,
        border=cola,axes=FALSE,drawRect=F,lwd=1,wex=0.8)

mg_cb_sum <- cs_cb %>% group_by(id, group, sex_num) %>% summarize(P = mean(C_iv))

beeswarm(mg_cb_sum$P~mg_cb_sum$group,col=colc,at=c(1:4),
         add=T,pwpch=(16.5+mg_cb_sum$sex_num),
         corral = "wrap")

tp<-groupquant[3,]
xx<-1;wid=0.25
repeat{
  lines(c(xx-wid,xx+wid),c(tp[xx],tp[xx]),lwd=2,col="black");
  lines(c(xx,xx),c(groupquant[1,xx],groupquant[2,xx]),lwd=1.7,col="black")
  xx<-xx+1
  if(xx>4){break}}

tckk=-0.02
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=3),
     labels=c(rep("",length(seq(range[1],range[2],by=3)))),pos=xrange[1],tck=tckk)
axis(2,las=2,cex.axis=1.1,at=seq(range[1],range[2],by=9),pos=xrange[1],tck=tckk)

axis(side=1,las=1,cex.axis=1.1,at=c(seq(1,4,by=1)),
     labels=c(rep("",length(seq(1,4,by=1)))),pos=range[1],tck=tckk)
lines(c(xrange[1],xrange[2]),c(range[1],range[1]))
text(c(1:4),c(rep(range[1]-0.046*scal,4)),xpd=T,cex=1.1,col=cola,
     c("Wt","Wt", "SCA1", "SCA1"))
ypo<-c(range[1]-0.1*scal,range[1]-0.1*scal)
text(c(1:4),c(ypo[1],ypo[2],ypo[1],ypo[2]),xpd=T,cex=1.1,col=cola,
     c("0","edv", "0", "edv"))
text(mean(xrange),range[2]+0.05*scal,"Complex IV",cex=1.6,font=3,xpd=T)

## probability distributions -------------
### PD - P ----------
par(mar=c(2,1,0,0))
dif<-data.frame(post_fix_cs_cb_P$wt_contrast,post_fix_cs_cb_P$b_P_groupeda.sca,
                post_fix_cs_cb_P$b_P_groupctrl.wt)
dif<-exp(dif)
yla<-"Fold-difference in respiration"
tckk=-0.018
ste<-seq(0.2,2.2,by=0.2)
mons_poste(dif,1)

zpos=seq(0,1,1/3)
xx=1;ind=0.5;xpol<-0.4;srt=55
text(xpol,zpos[xx]+zpos[2]*ind,
     "Wt: ed x 0 ",cex=1,srt=srt,xpd=T)
xx=xx+1

text(xpol,zpos[xx]+zpos[2]*ind,
     "SCA1: ed x 0 ",cex=1,srt=srt,xpd=T)
xx=xx+1

text(xpol,zpos[xx]+zpos[2]*ind,
     "0: Wt x SCA1",cex=1,srt=srt,xpd=T)

### PD - _S ----------
dif<-data.frame(post_fix_cs_cb_S$wt_contrast,post_fix_cs_cb_S$b_S_groupeda.sca,
                post_fix_cs_cb_S$b_S_groupctrl.wt)
dif<-exp(dif)
yla<-"Fold-difference in respiration"
tckk=-0.018
ste<-seq(0.2,2.2,by=0.2)
mons_poste(dif,1)

### PD - _Fccp ----------
dif<-data.frame(post_fix_cs_cb_Fccp$wt_contrast,post_fix_cs_cb_Fccp$b_Fccp_groupeda.sca,
                post_fix_cs_cb_Fccp$b_Fccp_groupctrl.wt)
dif<-exp(dif)
yla<-"Fold-difference in respiration"
tckk=-0.018
ste<-seq(0.2,2.2,by=0.2)
mons_poste(dif,1)

### PD - _Rot ----------
dif<-data.frame(post_fix_cs_cb_Rot$wt_contrast,post_fix_cs_cb_Rot$b_Rot_groupeda.sca,
                post_fix_cs_cb_Rot$b_Rot_groupctrl.wt)
dif<-exp(dif)
yla<-"Fold-difference in respiration"
tckk=-0.018
ste<-seq(0.2,2.2,by=0.2)
mons_poste(dif,1)

### PD - _Civ ----------
dif<-data.frame(post_fix_cs_cb_Civ$wt_contrast,post_fix_cs_cb_Civ$b_Civ_groupeda.sca,
                post_fix_cs_cb_Civ$b_Civ_groupctrl.wt)
dif<-exp(dif)
yla<-"Fold-difference in respiration"
tckk=-0.018
ste<-seq(0.2,2.2,by=0.2)
mons_poste(dif,1)
} ) )
```
